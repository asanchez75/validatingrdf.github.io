<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="hevea 2.23">
<link rel="stylesheet" type="text/css" href="bookHtml.css">
<title>Shape Expressions</title>
</head>
<body>
<a href="bookHtml009.html"><img src="previous_motif.gif" alt="Previous"></a>
<a href="index.html"><img src="contents_motif.gif" alt="Up"></a>
<a href="bookHtml011.html"><img src="next_motif.gif" alt="Next"></a>
<hr>
<h1 class="chapter" id="sec60">Chapter 4  Shape Expressions</h1>
<p> 
<a id="ch040ShEx"></a>
<a id="ch4"></a></p><p><a id="hevea_default273"></a> 
<a id="hevea_default274"></a> 
<a id="hevea_default275"></a> 
<a id="hevea_default276"></a>
<a id="hevea_default277"></a>
<a id="hevea_default278"></a>
Shape Expressions (ShEx) is a schema language for describing RDF graphs structures.
ShEx was originally developed in late 2013 to provide a human-readable syntax for OSLC Resource Shapes.
It added disjunctions, so it was more expressive than Resource Shapes.
Tokens in the language were adopted from Turtle [<a href="bookHtml018.html#EricSemantics2014">80</a>] and 
SPARQL [<a href="bookHtml018.html#SPARQL11">44</a>] with tokens for grouping, repetition and wildcards from regular expression and RelaxNG Compact Syntax [<a href="bookHtml018.html#RelaxNG">100</a>].
The language was described in a paper [<a href="bookHtml018.html#EricSemantics2014">80</a>] 
and codified in a June 2014 W3C member submission [<a href="bookHtml018.html#ShExSubmission14">92</a>] which included a primer and a semantics specification.
This was later deemed “ShEx 1.0”.</p><p><a id="hevea_default279"></a>
The W3C Data Shapes Working group started in September 2014 and quickly coalesced into two groups: the ShEx camp and the SHACL camp.
In 2016, the ShEx camp split from the Data Shapes Working Group to form a ShEx Community Group (CG).
In April of 2017, the ShEx CG released ShEx 2 with a primer, a semantic specification and a test-suite with implementation reports.</p><p>As of publication, the ShEx Community Group was starting work on ShEx 2.1 to add features like value comparison and unique keys.
See the ShEx Homepage <a href="http://shex.io/"><span class="c011">http://shex.io/</span></a> for the state of the art in ShEx.
A collection of ShEx schemas has also been started at <a href="https://github.com/shexSpec/schemas"><span class="c011">https://github.com/shexSpec/schemas</span></a>.</p>
<h2 class="section" id="sec61">4.1  Use of ShEx</h2>
<p>
<a id="ch4.sec1"></a></p><p><a id="hevea_default280"></a>
Strictly speaking, a ShEx schema defines a set of graphs.
This can be used for many purposes, including communicating data structures associated with some process or interface, generating or validating data, or driving user interface generation and navigation.
At the core of all of these use cases is the notion of conformance with schema.
Even one is using ShEx to create forms, the goal is to accept and present data which is valid with respect to a schema.</p><p>ShEx has several serialization formats:</p><ul class="itemize"><li class="li-itemize"><p><a id="hevea_default281"></a>
</p>a concise, human-readable compact syntax (ShExC);<p><a id="hevea_default282"></a> <a id="hevea_default283"></a>
</p></li><li class="li-itemize">a JSON-LD syntax (ShExJ) which serves as an abstract syntax; and <p><a id="hevea_default284"></a>
</p></li><li class="li-itemize">an RDF representation (ShExR) derived from the JSON-LD syntax.</li></ul><p>These are all isomorphic and most implementations can map from one to another.</p><p>Tools that derive schemas by inspection or translate them from other schema languages typically generate ShExJ.
Interactions with users, e.g., in specifications are almost always in the compact syntax ShExC.
<a id="hevea_default285"></a>
As a practical example, in HL7 FHIR, ShExJ schemas are automatically generated from other formats, 
and presented to the end user using compact syntax.
See Section <a href="bookHtml012.html#ch070.FHIRRDFDevelopment">6.2.3</a> for more details. </p><p><a id="hevea_default286"></a>
ShExR allows to use RDF tools to manage schemas, e.g., 
doing a SPARQL query to find out whether an organization is using 
<code>dc</code><code>:</code><code>creator</code> with a string, 
a 
<code>foaf</code><code>:</code><code>Person</code>, or even whether an organization is consistent about it.</p>
<h2 class="section" id="sec62">4.2  First Example</h2>
<p>
<a id="ch4.sec2"></a></p><p>Example <a href="#ch040%3AShExSimpleExample">26</a> below contains a very simple ShEx schema. 
<a id="hevea_default287"></a> 
<a id="hevea_default288"></a> 
<a id="hevea_default289"></a> </p><ul class="itemize"><li class="li-itemize">The first three lines declare prefixes using the same syntax as SPARQL Turtle. </li><li class="li-itemize">Nest line defines a shape called 
<code>:</code><code>User</code>. Nodes with that shape must satisfy the following constraints on their properties.</li><li class="li-itemize">They must have exactly one value for property 
<code>schema</code><code>:</code><code>name</code> which must be a 
<code>xsd</code><code>:</code><code>string</code>.</li><li class="li-itemize">They can have an optional property 
<code>schema</code><code>:</code><code>birthDate</code> with type 
<code>xsd</code><code>:</code><code>date</code>.</li><li class="li-itemize">They must have exactly one property 
<code>schema</code><code>:</code><code>gender</code> whose value is 
<code>schema</code><code>:</code><code>Male</code> or 
<code>schema</code><code>:</code><code>Female</code> or some string.</li><li class="li-itemize">They can have zero or more properties 
<code>schema</code><code>:</code><code>knows</code> whose value must be an IRI and conform to the 
<code>:</code><code>User</code> shape.</li></ul><div class="example"><div class="theorem"><span class="c014">Example 26</span>  <em>Simple ShEx Schema</em><em>
</em><a id="ch040:ShExSimpleExample"></a><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c007">PREFIX</span></span></em><em><span class="c012"> :       &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c007">PREFIX</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">: &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c007">PREFIX</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:  &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">www</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">w3</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/2001/</span></em><em><span class="c012"><span class="c007">XMLSchema</span></span></em><em><span class="c012">#&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">          </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">  ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">birthDate</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">date</span></span></em><em><span class="c012">?  ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">gender</span></span></em><em><span class="c012">        [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Male</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Female</span></span></em><em><span class="c012"> ] </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012">         </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>All the nodes in the following RDF graph conform to </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> shape.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">           </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;            </span></em><span class="c012"><em><span class="c012">#  \Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012">         </span></em><em><span class="c012">schema:Female</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012">          </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012">         </span></em><em><span class="c012">schema:Male</span></em><em><span class="c012"> ;        </span></em><span class="c012"><em><span class="c012">#  \Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">           </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"1980-03-10"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:date</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">           </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;            </span></em><span class="c012"><em><span class="c012">#  \Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"unspecified"</span></em></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">foaf:name</span></em><em><span class="c012">             </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>The nodes </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em>, </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>carol</em></code><em> have shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>. </em></p><ul class="itemize"><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> conforms because it contains </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>gender</em></code><em> with their corresponding values.
It does not contain the property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>birthDate</em></code><em> but that property is optional, as indicated by ‘</em><em>
</em><code><em>?</em></code><em>‘.
It also has the property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>knows</em></code><em> with the value </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> which has </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> shape.</em></li><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> conforms because it contains the properties and values of the </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> shape. 
Note that the order in which triples are expressed in the example does not matter. These are parsed into an RDF graph and RDF graphs are unordered collections of triples.</em></li><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>carol</em></code><em> conforms because it has property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> with a </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value, 
</em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>gender</em></code><em> with another </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value and an extra property 
</em><em>
</em><code><em>foaf</em></code><code><em>:</em></code><code><em>name</em></code><em>.</em><p><em>Notice that </em><em>
</em><code><em>:</em></code><code><em>carol</em></code><em> conforms even if it has other properties apart of those mentioned by the </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> shape definition (in this case </em><em>
</em><code><em>foaf</em></code><code><em>:</em></code><code><em>name</em></code><em>).</em></p><p><em>ShEx shapes are open by default, which means that they constrain neither the existence nor the value of the properties not mentioned in the shape.
This behavior can be modified using the </em><em>
</em><code><em>CLOSED</em></code><em> qualifier as we will explain in Section </em><a href="#ch040%3ASecClosedShapes"><em>4.6.8</em></a><em>.</em></p></li></ul><p><em>Given the following RDF graph:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">           </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012">;         </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"XYY"</span></em></span></em><em><span class="c012">;          </span></em><span class="c012"><em><span class="c012">#</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012">      1980 .          </span></em><span class="c012"><em><span class="c012">#  1980 is not an xsd:date *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:emily</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Emily"</span></em></span></em><em><span class="c012">,</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Emilee"</span></em></span></em><em><span class="c012"> ;       </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012">         </span></em><em><span class="c012">schema:Female</span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#  too many schema:names *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:frank</span></em><em><span class="c012"> </span></em><em><span class="c012">foaf:name</span></em><em><span class="c012">             </span></em><em><span class="c012"><em><span class="c012">"Frank"</span></em></span></em><em><span class="c012"> ;       </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:gender:</span></em><em><span class="c012">        </span></em><em><span class="c012">schema:Male</span></em><em><span class="c012"> .   </span></em><span class="c012"><em><span class="c012">#  missing schema:name *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:grace</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">           </span></em><em><span class="c012"><em><span class="c012">"Grace"</span></em></span></em><em><span class="c012"> ;       </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012">         </span></em><em><span class="c012">schema:Male</span></em><em><span class="c012"> ;   </span></em><span class="c012"><em><span class="c012"># </span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012">          </span></em><em><span class="c012">_:x</span></em><em><span class="c012"> .           </span></em><span class="c012"><em><span class="c012">#  \_:x is not an IRI *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:harold</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"Harold"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:Male</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012">        </span></em><em><span class="c012">:grace</span></em><em><span class="c012"> .      </span></em><span class="c012"><em><span class="c012">#  :grace does not conform to :User *)</span></em></span></td></tr>
</table><p><em>If we try to validate the nodes in the following graph against the shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>, the validator would fail for all of the nodes:</em></p><ul class="itemize"><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>dave</em></code><em> fails because the value of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>birthDate</em></code><em> is </em><em>
</em><code><em>1980</em></code><em> (an integer) which is not an </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>date</em></code><em>.</em></li><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>emily</em></code><em> fails because it has two values for property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em>.
Unless otherwise specified, the default cardinality is “exactly one” (which can also be written as “</em><em>
</em><code><em>{1}</em></code><em>” or “</em><em>
</em><code><em>{1,1}</em></code><em>”).</em></li><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>frank</em></code><em> fails because it does not have the property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em>.</em></li><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>grace</em></code><em> fails because the value of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>knows</em></code><em> is a blank node and there is a node constraint saying that it must be an IRI.</em></li><li class="li-itemize"><em>
</em><code><em>:</em></code><code><em>harold</em></code><em> fails because the value of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>knows</em></code><em> is </em><em>
</em><code><em>:</em></code><code><em>grace</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>grace</em></code><em> does not conform to the </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> shape.</em></li></ul></div></div>
<h2 class="section" id="sec63">4.3  ShEx implementations</h2>
<p> <a id="Ch04ShexImplementations"></a></p><p>At the time of this writing, we are aware of the following implementations of ShEx.</p><ul class="itemize"><li class="li-itemize"><p><a id="hevea_default290"></a>
<a id="hevea_default291"></a>
</p>shex.js for Javascript/N3.js (Eric Prud’hommeaux) <a href="https://github.com/shexSpec/shex.js/"><span class="c011">https://github.com/shexSpec/shex.js/</span></a>;<p><a id="hevea_default292"></a>
<a id="hevea_default293"></a>
<a id="hevea_default294"></a>
</p></li><li class="li-itemize">Shaclex for Scala/Jena (Jose Emilio Labra Gayo) <a href="https://github.com/labra/shaclex/"><span class="c011">https://github.com/labra/shaclex/</span></a>;<p><a id="hevea_default295"></a>
<a id="hevea_default296"></a>
</p></li><li class="li-itemize">shex.rb for Ruby/RDF.rb (Gregg Kellogg) <a href="https://github.com/ruby-rdf/shex"><span class="c011">https://github.com/ruby-rdf/shex</span></a>;<p><a id="hevea_default297"></a>
<a id="hevea_default298"></a>
</p></li><li class="li-itemize">Java ShEx for Java/Jena (Iovka Boneva/University of Lille) <a href="https://gforge.inria.fr/projects/shex-impl/"><span class="c011">https://gforge.inria.fr/projects/shex-impl/</span></a>; and<p><a id="hevea_default299"></a>
</p></li><li class="li-itemize">ShExkell for Haskell (Sergio Iván Franco and Weso Research Group) <a href="https://github.com/weso/shexkell"><span class="c011">https://github.com/weso/shexkell</span></a>.</li></ul><p>There are also several online demos and tools that can be used to experiment with ShEx.</p><ul class="itemize"><li class="li-itemize">shex.js (<a href="http://rawgit.com/shexSpec/shex.js/master/doc/shex-simple.html"><span class="c011">http://rawgit.com/shexSpec/shex.js/master/doc/shex-simple.html</span></a>);</li><li class="li-itemize">Shaclex (<a href="http://shaclex.herokuapp.com"><span class="c011">http://shaclex.herokuapp.com</span></a>); and </li><li class="li-itemize">ShExValidata (for ShEx 1.0) (<a href="https://www.w3.org/2015/03/ShExValidata/"><span class="c011">https://www.w3.org/2015/03/ShExValidata/</span></a>).
</li></ul>
<h2 class="section" id="sec64">4.4  The Shape Expressions Language</h2>
<p> 
<a id="ch040ShapeExpressions"></a>
<a id="ch4.sec3"></a></p>
<h3 class="subsection" id="sec65">4.4.1  Shape Expressions Compact Syntax</h3>
<p> 
<a id="ch040ShExC"></a>
<a id="ch4.sec3.1"></a></p><p><a id="hevea_default300"></a> 
<a id="hevea_default301"></a> 
<a id="hevea_default302"></a> 
<a id="hevea_default303"></a>
The ShEx compact syntax (ShExC) was designed to be read and edited by humans.
It follows some conventions which are similar to Turtle or SPARQL. </p><ul class="itemize"><li class="li-itemize"><p><a id="hevea_default304"></a>
<a id="hevea_default305"></a>
</p>
<code>PREFIX</code> and 
<code>BASE</code> declarations follow the same convention as in Turtle. 
In the rest of this chapter we will omit prefix declarations for brevity.<p><a id="hevea_default306"></a>
</p></li><li class="li-itemize">Comments start with a 
<code>#</code> and continue until the end of line.
<p><a id="hevea_default307"></a> <a id="hevea_default308"></a>
</p></li><li class="li-itemize">The keyword 
<code>a</code> identifies the 
<code>rdf</code><code>:</code><code>type</code> property.<p><a id="hevea_default309"></a> <a id="hevea_default310"></a> 
</p></li><li class="li-itemize">Relative and absolute IRIs are enclosed by 
<code>&lt;</code>
<code>&gt;</code> and prefixed names (a shorter way to write out IRIs) are written with prefix followed by a colon “:”.<p><a id="hevea_default311"></a>
</p></li><li class="li-itemize">Blank nodes are identified using 
<code>_</code><code>:</code><code>label</code> notation.<p><a id="hevea_default312"></a> <a id="hevea_default313"></a>
</p></li><li class="li-itemize">Literals can be enclosed by the same quotation conventions (
<code>'</code>, 
<code>"</code>, 
<code>'''</code>, 
<code>"""</code>) as in Turtle.</li><li class="li-itemize">Keywords (apart from 
<code>a</code>) are not case sensitive. 
Which means that 
<code>MinInclusive</code> is the same as 
<code>MININCLUSIVE</code>.
</li></ul><p><a id="hevea_default314"></a>
A ShExC document declares a ShEx schema.
A ShEx schema is a set of labeled shape expressions which are composed of node constraints and shapes.
These constrain the permissible values or graph structure around a node in an RDF graph.
<a id="hevea_default315"></a>
When we are considering a specific node, we call that node the 
<code>focus</code><code> </code><code>node</code>.</p><p><a id="hevea_default316"></a> <a id="hevea_default317"></a> <a id="hevea_default318"></a>
The triples which have the focus node as a subject are called 
<code>outgoing</code><code> </code><code>arcs</code>; those with the focus node as an object are called 
<code>incoming</code><code> </code><code>arcs</code>.
(Typical RDF idioms call for constraints on outgoing arcs much more frequently than on incoming arcs.)
Together, the incoming and outgoing arcs are called the 
<code>neighborhood</code> of that node.</p><p>Shape expression labels can be IRIs or blank nodes but only IRI labels can be referenced from outside the schema.
In the previous Example <a href="#ch040%3AShExSimpleExample">26</a>, 
<code>:</code><code>User</code> is an IRI label.</p><p><a id="hevea_default319"></a>
Node constraints declare the shape of a focus node without looking at the arcs. 
<a id="hevea_default320"></a>
<a id="hevea_default321"></a>
<a id="hevea_default322"></a>
<a id="hevea_default323"></a>
They can declare the kind of node (IRI, blank node or literal), 
the datatype in case of literals, 
describe it with XML Schema facets (e.g., min and max numeric values, string lengths, number of digits), 
or enumerate a value set.
Figure <a href="#ch040FigureNodeConstraints">4.4.1</a> signals the node constraints that appear in Example <a href="#ch040%3AShExSimpleExample">26</a> which are:

<code>xsd</code><code>:</code><code>string</code> and 
<code>xsd</code><code>:</code><code>date</code> (datatype constraints), 

<code>[</code><code>schema</code><code>:</code><code>Male</code><code> </code><code>schema</code><code>:</code><code>Female</code><code>]</code> (a value set),

<code>IRI</code> (a node kind declaration) and 

<code>@</code><code>:</code><code>User</code> (a value shape). 
Node constraints will be described in more detail in Section <a href="#ch040NodeConstraints">4.5</a>.</p><blockquote class="figure"><div class="center"><hr class="c022"></div> 
<div class="center">
<img src="ShEx_NodeConstraints.png">
</div>

<a id="ch040FigureNodeConstraints"></a>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Figure 4.1: Node constraints in a shape.</td></tr>
</table></div>
<div class="center"><hr class="c022"></div></blockquote><p><a id="hevea_default324"></a>
<a id="hevea_default325"></a>
<a id="hevea_default326"></a>
<a id="hevea_default327"></a>
<a id="hevea_default328"></a>
Triple constraints define the triples that appear in the neighborhood of a focus node. 
They usually contain a property (or inverse property), a node constraint, and a cardinality declaration which is one by default.</p><p>For example, 
<code>schema</code><code>:</code><code>name</code><code> </code><code>xsd</code><code>:</code><code>string</code> is a triple constraint.
The 
<code>:</code><code>User</code> shape from Example <a href="#ch040%3AShExSimpleExample">26</a> 
was formed by four triple constraints. 
Triple constraints will be described later in Section <a href="#ch040tripleconstraints">4.6.1</a>.</p><blockquote class="figure"><div class="center"><hr class="c022"></div> 
<div class="center">
<img src="ShEx_TripleConstraints.png">
</div>

<a id="ch040FigureTripleConstraints"></a>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Figure 4.2: Triple constraints in a shape.</td></tr>
</table></div>
<div class="center"><hr class="c022"></div></blockquote><p><a id="hevea_default329"></a>
Triple constraints can be grouped using the semicolon operator 
<code>;</code> to form 
triple expressions.<sup><a id="text8" href="#note8">1</a></sup> 
<a id="hevea_default330"></a>
<a id="hevea_default331"></a>
Shapes are enclosed by curly braces 
<code>{</code>
<code>}</code> and contain triple expressions. </p><p><a id="hevea_default332"></a>
<a id="hevea_default333"></a>
<a id="hevea_default334"></a>
Shapes are the basic form of shape expressions, although more complex shape expressions can be formed by combining the logical operators 
<code>AND</code>, 
<code>OR</code> and 
<code>NOT</code> which will be later described in Section <a href="#ch040.LogicalOperatorsShEx">4.6</a>.
Shape expressions are identified by shape expression labels.</p><blockquote class="figure"><div class="center"><hr class="c022"></div> 
<div class="center">
<img src="ShEx_Shape.png">
</div>

<a id="ch040FigureShape"></a>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Figure 4.3: Shapes, shape expression labels and triple expressions.</td></tr>
</table></div>
<div class="center"><hr class="c022"></div></blockquote><p>Figure <a href="#ch040FigureShapeExpression">4.4.1</a> shows a compound shape expression formed by combining the shape reference 
<code>@</code><code>:</code><code>User</code> 
with a shape that contains a single triple constraint 
<code>:</code><code>teaches</code><code> </code><code>@</code><code>:</code><code>Course</code> using the 
<code>AND</code> operator.</p><p><a id="hevea_default335"></a>
The full ShEx BNF grammar is specified at <a href="http://shex.io/shex-semantics/\#shexc"><span class="c011">http://shex.io/shex-semantics/\#shexc</span></a>.</p><blockquote class="figure"><div class="center"><hr class="c022"></div> 
<div class="center">
<img src="ShEx_ShapeExpressions.png">
</div>

<a id="ch040FigureShapeExpression"></a>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Figure 4.4: Shape expression and shape.</td></tr>
</table></div>
<div class="center"><hr class="c022"></div></blockquote>
<h3 class="subsection" id="sec66">4.4.2  Invoking Validation</h3>
<p> 
<a id="ch040ValidationProcess"></a> 
<a id="ch4.sec3.2"></a></p><p><a id="hevea_default336"></a>
In Example <a href="#ch040%3AShExSimpleExample">26</a>, we tested several RDF nodes (
<code>:</code><code>alice</code>, 
<code>:</code><code>bob</code>, ... 
<code>:</code><code>harold</code>) against the shape 
<code>:</code><code>User</code>.</p><p>ShEx validation takes as input a schema, an RDF graph, and a shape map, and returns another shape map.</p><p><a id="hevea_default337"></a>
The input shape map (called <em>fixed shape map</em>) contains a list of 
<code>nodeSelector@shapeLabel</code> associations separated by commas, 
where 
<code>nodeSelector</code> is an RDF node and 
<code>shapeLabel</code> is a shape label.
Both use N-Triples notation.</p><p>A fixed map would look like:</p><table class="lstframe c015"><tr><td class="lstlisting"><span class="c012">&lt;</span><span class="c012"><span class="c007">http</span></span><span class="c012">://</span><span class="c012"><span class="c007">data</span></span><span class="c012">.</span><span class="c012"><span class="c007">example</span></span><span class="c012">/#</span><span class="c012"><span class="c007">alice</span></span><span class="c012">&gt;</span><span class="c012"><span class="c007">@</span></span><span class="c012">&lt;</span><span class="c012"><span class="c007">http</span></span><span class="c012">://</span><span class="c012"><span class="c007">schema</span></span><span class="c012">.</span><span class="c012"><span class="c007">example</span></span><span class="c012">/#</span><span class="c012"><span class="c007">User</span></span><span class="c012">&gt;,</span><span class="c012">
</span><span class="c012">&lt;</span><span class="c012"><span class="c007">http</span></span><span class="c012">://</span><span class="c012"><span class="c007">data</span></span><span class="c012">.</span><span class="c012"><span class="c007">example</span></span><span class="c012">/#</span><span class="c012"><span class="c007">bob</span></span><span class="c012">&gt;</span><span class="c012"><span class="c007">@</span></span><span class="c012">&lt;</span><span class="c012"><span class="c007">http</span></span><span class="c012">://</span><span class="c012"><span class="c007">schema</span></span><span class="c012">.</span><span class="c012"><span class="c007">example</span></span><span class="c012">/#</span><span class="c012"><span class="c007">User</span></span><span class="c012">&gt;</span></td></tr>
</table><p>Although shape maps use absolute IRIs for RDF nodes and shape labels, 
we will use prefixes to abbreviate them in our listings:</p><table class="lstframe c015"><tr><td class="lstlisting"><span class="c012">:</span><span class="c012"><span class="c007">alice@</span></span><span class="c012">:</span><span class="c012"><span class="c007">User</span></span><span class="c012">,</span><span class="c012">
</span><span class="c012">:</span><span class="c012"><span class="c007">bob@User</span></span></td></tr>
</table><p>Note that during evaluation, the processor may need to check the conformance of other nodes against other shapes. </p><div class="example"><div class="theorem"><span class="c014">Example 27</span>  <em>Invoking validation example</em><p><em>If we define the following schema:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>and the RDF graph:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> </span></em><em><span class="c012">:carol</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>when we invoke a ShEx processor with the fixed shape map: </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">alice@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bob@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em></td></tr>
</table><p><em>the result shape map is:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">alice@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bob@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">carol@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em></td></tr>
</table><p><em>The reason is that in order to check that </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> conforms to </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>, the processor must check that </em><em>
</em><code><em>:</em></code><code><em>carol</em></code><em> also conforms to </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> and hence, it adds the association </em><em>
</em><code><em>:</em></code><code><em>carol@</em></code><code><em>:</em></code><code><em>User</em></code><em> to the result shape map.</em></p><p><em>Figure </em><a href="#ch040.ShExValidatorProcess"><em>4.5</em></a><em> depicts the validation process.</em></p><blockquote class="figure"><div class="center"><hr class="c022"></div><em> 
</em><div class="center"><em>
<img src="ShExValidator.png">
</em></div><em>

</em><div class="caption"><table class="c002 cellpading0"><tr><td class="c019"><em>Figure 4.5: Validation process which accepts a fixed shape map and 
emits a result shape map.</em></td></tr>
</table></div><em>
</em><a id="ch040.ShExValidatorProcess"></a><em>
</em><div class="center"><hr class="c022"></div></blockquote></div></div><p>There are many use case-dependent ways to compose a fixed shape map.
<a id="hevea_default338"></a> <a id="hevea_default339"></a>
ShEx defines a common one called <em>query shape map</em> which uses triple patterns to select nodes.
Triple patterns use curly braces and three values that represent the subject, predicate and object of a triple.
They can contain the value 
<code>FOCUS</code> to identify the node we want to select and 

<code>_</code> to indicate that we do not constrain some value.</p><div class="example"><div class="theorem"><span class="c014">Example 28</span>  <em>Query map example</em><p><em>The following query map selects all subjects of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em>, all objects of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>knows</em></code><em> and nodes that have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> with value </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Person</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">{</span></em><em><span class="c012"><span class="c007">FOCUS</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">_</span></span></em><em><span class="c012">}</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">{</span></em><em><span class="c012"><span class="c007">_</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">FOCUS</span></span></em><em><span class="c012">}</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">{</span></em><em><span class="c012"><span class="c007">FOCUS</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">type</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012">}</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em></td></tr>
</table></div></div><p>Section <a href="#ch040ShapeMaps">4.9</a> describes fixed shape maps and query shape maps in greater detail.</p><p>In the previous example, validating 
<code>:</code><code>alice</code> as a 
<code>:</code><code>User</code> entailed validating 
<code>:</code><code>carol</code> as a 
<code>:</code><code>User</code>.
Unless the validation engine has some sort of state persistence, 
it would be more efficient to validate once with a shape map like:</p><table class="lstframe c015"><tr><td class="lstlisting"><span class="c012">:</span><span class="c012">alice@</span><span class="c012">:</span><span class="c012">User</span><span class="c012">,:</span><span class="c012">carol@</span><span class="c012">:</span><span class="c012">User</span></td></tr>
</table><p>than to validate 
<code>:</code><code>alice</code> and 
<code>:</code><code>carol</code> separately.</p><p>Validating a shape map with multiple nodeSelector/shapeLabel pairs allows the engine to leverage any pairs that it has already tested.</p>
<h3 class="subsection" id="sec67">4.4.3  Structure of Shape Expressions</h3>
<p> 
<a id="ch040StructureofaShapeExpression"></a>
<a id="ch4.sec3.3"></a></p><p><a id="hevea_default340"></a> <a id="hevea_default341"></a> <a id="hevea_default342"></a> <a id="hevea_default343"></a>
In Section <a href="#ch040ShExC">4.4.1</a>, we described shape expressions as being composed of node constraints and shapes.
These can also be combined with the logical operators 
<code>And</code>, 
<code>Or</code> and 
<code>Not</code>.

<code>And</code> and 
<code>Or</code> expressions in turn contain two or more shape expressions.
When we refer to a 
<code>shape</code><code> </code><code>expression</code>, we mean one of the following. </p><ul class="itemize"><li class="li-itemize"><p><a id="hevea_default344"></a> 
</p>A node constraint, which constrains the set of allowed values of a node. <p><a id="hevea_default345"></a>
</p></li><li class="li-itemize">A shape, which constrains the neighborhood of a node.<p><a id="hevea_default346"></a>
</p></li><li class="li-itemize">An 
<code>And</code> of two or more shape expressions (called 
<code>ShapeAnd</code>).<p><a id="hevea_default347"></a>
</p></li><li class="li-itemize">An 
<code>Or</code> of two or more shape expressions (called 
<code>ShapeOr</code>).<p><a id="hevea_default348"></a>
</p></li><li class="li-itemize">A 
<code>Not</code> of one shape expression (called 
<code>ShapeNot</code>)<p><a id="hevea_default349"></a>
</p></li><li class="li-itemize">An external shape expression.</li></ul><p>This recursive structure forms a tree which has node constraints and shapes as leaves. 
Figure <a href="#ch040.ShExModel">4.6</a> represents the ShEx data model.</p><blockquote class="figure"><div class="center"><hr class="c022"></div> 
<div class="center">
<img src="ShExModel.png">
</div>

<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Figure 4.6: ShEx data model.</td></tr>
</table></div>
<a id="ch040.ShExModel"></a>
<div class="center"><hr class="c022"></div></blockquote><p><a id="hevea_default350"></a> <a id="hevea_default351"></a>
Node constraints and shapes are described in the following sections while
the logical operators are discussed in Section <a href="#ch040LogicalOperators">4.8</a> and 
external shapes in Section <a href="#ch040.ExternalShapes">4.7.3</a>.</p><p><a id="hevea_default352"></a>
</p>
<h3 class="subsection" id="sec68">4.4.4  Start Shape Expression</h3>
<p> 
<a id="ch040startExpr"></a>
<a id="ch4.sec3.4"></a></p><p>The shape expression might be selected by label or it might default to a special shape called the 
<code>start</code> shape.</p><p><a id="hevea_default353"></a>
A schema can have one more shape expression called the 
<code>start</code> expression.
This serves as <em>start here</em> advice from the schema author
and is useful when describing a graph with a single purpose.
<a id="hevea_default354"></a>
For instance, the medical data protocol FHIR 
(see Section <a href="bookHtml012.html#ch060FHIR">6.2</a>) has specific schemas for resources like 
<code>Patient</code>.</p><div class="example"><div class="theorem"><span class="c014">Example 29</span>  <em>ShEx schema with start directive</em><p><em>Consider the following code:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c010">start</span></span></em><em><span class="c012"> = </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">&lt;</span></em><em><span class="c012"><span class="c007">Patient</span></span></em><em><span class="c012">&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">&lt;</span></em><em><span class="c012"><span class="c007">Patient</span></span></em><em><span class="c012">&gt; {</span></em><em><span class="c012">
</span></em><em><span class="c012">  ...</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">...</span></em></td></tr>
</table><p><em>In the compact syntax, the directive </em><em>
</em><code><em>start</em></code><code><em> = </em></code><code><em>@</em></code><code><em>&lt;</em></code><code><em>Patient</em></code><code><em>&gt;</em></code><em> declares that the shape expression </em><em>
</em><code><em>&lt;</em></code><code><em>Patient</em></code><code><em>&gt;</em></code><em> will be used by default if a shape is not explicitly provided in the shapes map.</em></p></div></div><p>In shape maps, it is possible to declare that a node must be validated against the shape map by using the keyword 
<code>START</code>. 
For example, the following shape map:</p><table class="lstframe c015"><tr><td class="lstlisting"><span class="c012">:</span><span class="c012"><span class="c007">alice@START</span></span><span class="c012">,</span><span class="c012">
</span><span class="c012">:</span><span class="c012"><span class="c007">bob@</span></span><span class="c012">&lt;</span><span class="c012"><span class="c007">Doctor</span></span><span class="c012">&gt;</span></td></tr>
</table><p>would validate 
<code>:</code><code>alice</code> against the start shape expression (in the previous example, it would be 
<code>&lt;</code><code>Patient</code><code>&gt;</code>) and 
<code>:</code><code>bob</code> against 
<code>&lt;</code><code>Doctor</code><code>&gt;</code>.</p>
<h2 class="section" id="sec69">4.5  Node Constraints</h2>
<p> 
<a id="ch040NodeConstraints"></a>
<a id="ch4.sec4"></a></p><p>Node constraints describe the allowed values of a node. 
<a id="hevea_default355"></a> 
<a id="hevea_default356"></a> 
<a id="hevea_default357"></a> 
<a id="hevea_default358"></a>
<a id="hevea_default359"></a>
These include specification of RDF node kind, 
literal datatype, string and numeric facets, and value sets. </p><p>Node constraints can appear as a labeled shape expression or as part of triple constraints.</p><div class="example"><div class="theorem"><span class="c014">Example 30</span>  <p><a id="hevea_default360"></a><em>
Any place one does </em>not<em> want a node constraint, can be marked with a period (</em><em>
</em><code><em>"."</em></code><em>).
This is analogous to the period which matches any character in regular expressions.
The following example lists the properties that a </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> must have but it does not specify any constraint in their values:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> . ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">alternateName</span></span></em><em><span class="c012"> . * ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">birthDate</span></span></em><em><span class="c012"> . ?</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>Given the following RDF graph: </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">        23 .         </span></em><span class="c012"><em><span class="c012"># \Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">          </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;   </span></em><span class="c012"><em><span class="c012"># \Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:alternateName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Bob"</span></em></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">                          </span></em><em><span class="c012"><em><span class="c012">"Bobby"</span></em></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">                          &lt;</span></em><em><span class="c012">Bob</span></em><em><span class="c012">&gt; ;</span></em><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Unknown"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>If we provide the shape map </em><em>
</em><code><em>:</em></code><code><em>alice@</em></code><code><em>:</em></code><code><em>User</em></code><code><em>,:</em></code><code><em>bob@</em></code><code><em>:</em></code><code><em>User</em></code><em> the ShEx processor would return that they both conform.</em></p></div></div><p><a id="hevea_default361"></a>
Node constraints usually appear as part of value expressions in triple constraints.</p><div class="example"><div class="theorem"><span class="c014">Example 31</span>  <em>Node constraint in a value expression</em><p><em>The following example declares that nodes with shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> must have a property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>url</em></code><em> whose value must be an </em><em>
</em><code><em>IRI</em></code><em>. </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">url</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table></div></div><p>Node constraints can also appear as top level shapes. </p><div class="example"><div class="theorem"><span class="c014">Example 32</span>  <em>Node constraint as top-level shape</em><p><em>The following code defines two shapes, </em><em>
</em><code><em>:</em></code><code><em>HomePage</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>CanVoteAge</em></code><em>,
which are defined as node constraints.
The first one declares that nodes must be </em><em>
</em><code><em>IRI</em></code><em>s and the second one that they must be </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>integer</em></code><em> values greater than 18.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">HomePage</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CanVoteAge</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">integer</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">MinInclusive</span></span></em><em><span class="c012"> 18</span></em></td></tr>
</table><p><em>If we provide a ShEx processor the shape map </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">&lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/</span></em><em><span class="c012"><span class="c007">alice</span></span></em><em><span class="c012">&gt;</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">HomePage</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">23</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CanVoteAge</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">45</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">HomePage</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">14</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CanVoteAge</span></span></em></td></tr>
</table><p><em>The result would be that the first two nodes are conformant while the last 
two nodes are non-conformant.</em></p></div></div><p>It is also possible to combine top-level node constraints with more complex shapes.</p><div class="example"><div class="theorem"><span class="c014">Example 33</span>  <em>Node constraint as top-level shape combined with complex shape</em><p><em>The following declaration of shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> says that nodes conforming to shape 
</em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> must be </em><em>
</em><code><em>IRI</em></code><em>s and have a property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> with an </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value. </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><a id="hevea_default362"></a><em>
In this case, the external </em><em>
</em><code><em>AND</em></code><em> can be omitted, so the previous shape is equivalent to:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table></div></div><p>Table <a href="#ch040.NodeConstraintsTable">4.1</a> gives an overview of the main types of node constraints with some examples and a short description.</p><blockquote class="table"><div class="center"><hr class="c022"></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Table 4.1: Node constraints</td></tr>
</table></div>
<a id="ch040.NodeConstraintsTable"></a> 
<div class="center">
<table class="c001 cellpadding1" border=1><tr><td class="c018"> <span class="c014">Name</span></td><td class="c020"><span class="c014">Description</span></td><td class="c020"><span class="c014">Examples
</span></td></tr>
<tr><td class="c018"> Anything</td><td class="c020">The value can be anything</td><td class="c020">
<code>.</code>
</td></tr>
<tr><td class="c018"> Datatype</td><td class="c020">The value must be an element of that datatype</td><td class="c020">
<code>xsd</code><code>:</code><code>string</code> <br>

<code>xsd</code><code>:</code><code>date</code> <br>

<code>cdt</code><code>:</code><code>distance</code> <br>
…</td></tr>
<tr><td class="c018"> Node kind</td><td class="c020">The value must have that kind</td><td class="c020">
<code>IRI</code> <br>

<code>BNode</code> <br>

<code>Literal</code> <br>

<code>NonLiteral</code>
</td></tr>
<tr><td class="c018"> Value set</td><td class="c020">The value must be an element of that set</td><td class="c020">
<code>[:</code><code>Male</code><code> :</code><code>Female</code><code>]</code>
</td></tr>
<tr><td class="c018"> Shape reference</td><td class="c020">The value must conform to 
<code>&lt;</code><code>User</code><code>&gt;</code></td><td class="c020">
<code>@</code><code>:</code><code>User</code> 
</td></tr>
</table>
</div>
<div class="center"><hr class="c022"></div></blockquote><p><a id="hevea_default363"></a>
</p>
<h3 class="subsection" id="sec70">4.5.1  Node kinds</h3>
<p> 
<a id="ch040NodeKinds"></a>
<a id="ch4.sec4.1"></a></p><p>Node kinds describe the kind that a value must have. 
There are four node kinds in ShEx: 
<code>Literal</code>, 
<code>IRI</code>, 
<code>BNode</code>, and 
<code>NonLiteral</code> 
which follow the rules defined in RDF 1.1 for such terms.</p><blockquote class="table"><div class="center"><hr class="c022"></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Table 4.2: Node kinds</td></tr>
</table></div>
<a id="ch040.NodeKind"></a> 
<div class="center">
<table class="c001 cellpadding1" border=1><tr><td class="c018"> <span class="c014">Value</span></td><td class="c020"><span class="c014">Description</span></td><td class="c020"><span class="c014">Examples
</span></td></tr>
<tr><td class="c018"> 
<code>Literal</code></td><td class="c020">Any RDF literal</td><td class="c020">
<code>"</code><code>Alice</code><code>"</code> <br>

<code>"</code><code>Spain</code><code>"</code><code>@en</code> <br>

<code>42</code> <br>

<code>true</code>
</td></tr>
<tr><td class="c018"> 
<code>IRI</code></td><td class="c020">Any RDF IRI</td><td class="c020">
<code>&lt;</code><code>http</code><code>://</code><code>example</code><code>.</code><code>org</code><code>/</code><code>Alice</code><code>&gt;</code> <br>

<code>ex</code><code>:</code><code>alice</code> <br>

<code>:</code><code>bob</code>
</td></tr>
<tr><td class="c018"> 
<code>BNode</code></td><td class="c020">Any blank node</td><td class="c020">
<code>_</code><code>:</code><code>x</code> <br>

<code>[]</code>
</td></tr>
<tr><td class="c018"> 
<code>NonLiteral</code></td><td class="c020">Any IRI or blank node</td><td class="c020">
<code>&lt;</code><code>http</code><code>://</code><code>example</code><code>.</code><code>org</code><code>/</code><code>alice</code><code>&gt;</code> <br>

<code>_</code><code>:</code><code>x</code> 
</td></tr>
</table>
</div><div class="center"><hr class="c022"></div></blockquote><div class="example"><div class="theorem"><span class="c014">Example 34</span>  <p><em>The following example declares that the value of property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> must be a literal and the value of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>follows</em></code><em> must be an IRI.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">Literal</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">follows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">    </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;  </span></em><span class="c012"><em><span class="c012">#  \Passes{:User} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:follows</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">    </span></em><em><span class="c012">:Bob</span></em><em><span class="c012"> ;     </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:follows</span></em><em><span class="c012"> </span></em><em><span class="c012">_:x</span></em><em><span class="c012"> .      </span></em><span class="c012"><em><span class="c012">#  :Bob is not a literal and \_:x is not an IRI *)</span></em></span></td></tr>
</table></div></div><p><a id="hevea_default364"></a>
</p>
<h3 class="subsection" id="sec71">4.5.2  Datatypes</h3>
<p> 
<a id="ch040Datatypes"></a>
<a id="ch4.sec4.2"></a></p><p>Like most schema languages, ShEx includes datatype constraints which declare that a focus node must be a literal with 
some specific datatype.
ShEx has special support for XML Schema datatypes [<a href="bookHtml018.html#XMLSchemaDatatypes">9</a>] 
for which it checks that the lexical form also conforms to the expected datatype.</p><div class="example"><div class="theorem"><span class="c014">Example 35</span>  <em>Simple datatypes</em><em> </em><a id="ch040SimpleDatatypes"></a><p><em>The following example declares the datatypes that must have the values of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>birthDate</em></code><em> properties.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">      </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">foaf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">age</span></span></em><em><span class="c012">         </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">integer</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">birthDate</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">date</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;                 </span></em><span class="c012"><em><span class="c012">#  \Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">foaf:age</span></em><em><span class="c012">         36 ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"1981-07-10"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:date</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:string</span></em><em><span class="c012"> ;   </span></em><span class="c012"><em><span class="c012">#  \Passes{:User} *)  </span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">foaf:age</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"26"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:integer</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"1981-07-10"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:date</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012">:Carol</span></em><em><span class="c012"> ;                 </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">foaf:age</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"14"</span></em></span></em><em><span class="c012"> ;                   </span></em><span class="c012"><em><span class="c012">#  :Carol is an IRI *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"2003-06-10"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:date</span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#  and "14" a string *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012"> ;                 </span></em><span class="c012"><em><span class="c012">#  \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">foaf:age</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"Unknown"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:integer</span></em><em><span class="c012">;  </span></em><span class="c012"><em><span class="c012">#  invalid lexical forms *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Unknown"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:date</span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><a id="hevea_default365"></a><em>
As we said, for XML Schema datatypes, 
ShEx also checks that the lexical form matches the expected datatype. 
For example, the </em><em>
</em><code><em>foaf</em></code><code><em>:</em></code><code><em>age</em></code><em> of </em><em>
</em><code><em>:</em></code><code><em>dave</em></code><em> is </em><em>
</em><code><em>"</em></code><code><em>Unknown</em></code><code><em>"^^</em></code><code><em>xsd</em></code><code><em>:</em></code><code><em>integer</em></code><em> and although it declares that </em><em>
</em><code><em>"</em></code><code><em>Unknown</em></code><code><em>"</em></code><em> is an integer
and some RDF parsers allow those declarations, 
</em><em>
</em><code><em>"</em></code><code><em>Unknown</em></code><code><em>"</em></code><em> does not have the integer’s lexical form and the ShEx processor will complain. 
The same happens for the value of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>birthDate</em></code><em>.</em></p></div></div><div class="example"><div class="theorem"><span class="c014">Example 36</span>  <em>Custom datatypes</em><p><a id="hevea_default366"></a><em>
</em><a id="hevea_default367"></a><em>
Although the most common use case is to use XML Schema datatypes, 
RDF data can use other datatypes.
In the following example, a picture contains the properties </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>width</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>height</em></code><em> using a hypothetical custom datatype for distances (</em><em>
</em><code><em>cdt</em></code><code><em>:</em></code><code><em>distance</em></code><em>).</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Picture</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">width</span></span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">cdt</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">distance</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">height</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">cdt</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">distance</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:gioconda</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Mona Lisa"</span></em></span></em><em><span class="c012">;                 </span></em><span class="c012"><em><span class="c012">#  \Passes{:Picture} *)  </span></em></span><em><span class="c012">
</span></em><em><span class="c012">          </span></em><em><span class="c012">schema:width</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"21 in"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">cdt:distance</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">          </span></em><em><span class="c012">schema:height</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"30 in"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">cdt:distance</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:other</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">   </span></em><em><span class="c012"><em><span class="c012">"Other picture"</span></em></span></em><em><span class="c012"> ;             </span></em><span class="c012"><em><span class="c012">#  \Fails{:Picture} *)  </span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:width</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"21 in"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:string</span></em><em><span class="c012"> ;         </span></em><span class="c012"><em><span class="c012">#  expected cdt:distance *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:height</span></em><em><span class="c012"> 30 .</span></em></td></tr>
</table></div></div><div class="example"><div class="theorem"><span class="c014">Example 37</span>  <em>Language-tagged literals</em><p><a id="hevea_default368"></a><em>
</em><a id="hevea_default369"></a><em>
The datatype </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>langString</em></code><em> identifies language-tagged literals (see </em><em>[</em><a href="bookHtml018.html#RDF11"><em>25, Section 3.3</em></a><em>]</em><em>), i.e., RDF literals that have a language tag.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Country</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">langString</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:italy</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Italia"</span></em></span></em><em><span class="c012">@es</span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Passes{:Country}*)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:france</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"France"</span></em></span></em><em><span class="c012"> .    </span></em><span class="c012"><em><span class="c012">#\Fails{:Country}*)  </span></em></span></td></tr>
</table></div></div>
<h3 class="subsection" id="sec72">4.5.3  Facets on Literals</h3>
<p> 
<a id="ch040facets"></a>
<a id="ch4.sec4.3"></a></p><p><a id="hevea_default370"></a>
<a id="hevea_default371"></a>
<a id="hevea_default372"></a>
XML Schema provides a useful library of string and numeric tests called <em>facets</em> [<a href="bookHtml018.html#XMLSchemaDatatypes">9</a>].
These facets are listed in Table <a href="#ch040.Facets">4.3</a> with a sample argument and some passing and failing values.</p><p><a id="hevea_default373"></a>
<a id="hevea_default374"></a>
<a id="hevea_default375"></a>
<a id="hevea_default376"></a>
<a id="hevea_default377"></a>
<a id="hevea_default378"></a>
<a id="hevea_default379"></a>
<a id="hevea_default380"></a>
<a id="hevea_default381"></a></p><blockquote class="table"><div class="center"><hr class="c022"></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Table 4.3: Facets on literals</td></tr>
</table></div>
<a id="ch040.Facets"></a> 
<div class="center">
<table class="c001 cellpadding1" border=1><tr><td class="c020"> <span class="c014">Facet and <br>
argument</span></td><td class="c020"><span class="c014">Passing values</span></td><td class="c020"><span class="c014">Failing values
</span></td></tr>
<tr><td class="c020"> 
<code>MinInclusive</code><code> 1</code></td><td class="c020">
<code>"1"^^</code><code>xsd</code><code>:</code><code>decimal</code>, <br>

<code>1</code>, 
<code>2</code>, 
<code>98</code>, 
<code>99</code>, 
<code>100</code></td><td class="c020">
<code>"1"^^</code><code>xsd</code><code>:</code><code>string</code>, <br>

<code>-1</code>, 
<code>0</code>
</td></tr>
<tr><td class="c020"> 
<code>MinExclusive</code><code> 1</code></td><td class="c020">
<code>2</code>, 
<code>98</code>, 
<code>99</code>, 
<code>100</code></td><td class="c020">
<code>-1</code>, 
<code>0</code>, 
<code>1</code>
</td></tr>
<tr><td class="c020"> 
<code>MaxInclusive</code><code> 99</code></td><td class="c020">
<code>1</code>, 
<code>2</code>, 
<code>98</code>, 
<code>99</code></td><td class="c020">
<code>100</code>
</td></tr>
<tr><td class="c020"> 
<code>MaxExclusive</code><code> 99</code></td><td class="c020">
<code>1</code>, 
<code>2</code>, 
<code>98</code></td><td class="c020">
<code>99</code>, 
<code>100</code>
</td></tr>
<tr><td class="c020"> 
<code>TotalDigits</code><code> 3</code></td><td class="c020">
<code>"1"^^</code><code>xsd</code><code>:</code><code>integer</code>, <br>

<code>9</code>, 
<code>999</code>, 
<code>0999</code>, <br>

<code>9.99</code>, 
<code>99.9</code>, 
<code>0.1020</code></td><td class="c020">
<code>"1"^^</code><code>xsd</code><code>:</code><code>string</code>, <br>

<code>1000</code>, 
<code>01000</code>, <br>

<code>1.1020</code>, 
<code>.1021</code>, 
<code>0.1021</code>
</td></tr>
<tr><td class="c020"> 
<code>FractionDigits</code><code> 3</code></td><td class="c020">
<code>"1"^^</code><code>xsd</code><code>:</code><code>decimal</code>, <br>

<code>0.1</code>, 
<code>0.1020</code>, 
<code>1.1020</code></td><td class="c020">
<code>"1"^^</code><code>xsd</code><code>:</code><code>integer</code>, <br>

<code>0.1021</code>, 
<code>0.10212</code>
</td></tr>
<tr><td class="c020"> 
<code>Length</code><code> 3</code></td><td class="c020">
<code>"123"^^</code><code>xsd</code><code>:</code><code>string</code>, <br>

<code>"123"^^</code><code>xsd</code><code>:</code><code>integer</code>, <br>

<code>"</code><code>abc</code><code>"</code></td><td class="c020">
<code>"12"^^</code><code>xsd</code><code>:</code><code>string</code>, <br>

<code>"12"^^</code><code>xsd</code><code>:</code><code>integer</code>, <br>

<code>"</code><code>ab</code><code>"</code>, 
<code>"</code><code>abcd</code><code>"</code>
</td></tr>
<tr><td class="c020"> 
<code>MinLength</code><code> 3</code></td><td class="c020">
<code>"</code><code>abc</code><code>"</code>, 
<code>"</code><code>abcd</code><code>"</code></td><td class="c020">
<code>""</code>, 
<code>"</code><code>ab</code><code>"</code>
</td></tr>
<tr><td class="c020"> 
<code>MaxLength</code><code> 3</code></td><td class="c020">
<code>""</code>, 
<code>"</code><code>ab</code><code>"</code>, 
<code>"</code><code>abc</code><code>"</code></td><td class="c020">
<code>"</code><code>abcd</code><code>"</code>, 
<code>"</code><code>abcde</code><code>"</code>
</td></tr>
<tr><td class="c020"> 
<code>/^</code><code>ab</code><code>+/</code> <br>
Regex pattern</td><td class="c020">
<code>"</code><code>ab</code><code>"</code>, 
<code>"</code><code>abb</code><code>"</code>, 
<code>"</code><code>abbcd</code><code>"</code></td><td class="c020">
<code>""</code>, 
<code>"</code><code>a</code><code>"</code>, 
<code>"</code><code>acd</code><code>"</code>, 
<code>"</code><code>cab</code><code>"</code> <br>

<code>"</code><code>AB</code><code>"</code>, 
<code>"</code><code>ABB</code><code>"</code>, 
<code>"</code><code>ABBCD</code><code>"</code>
</td></tr>
<tr><td class="c020"> 
<code>/^</code><code>ab</code><code>+/</code><code>i</code> <br>
Regex pattern <br>
with 
<code>i</code> flag</td><td class="c020">
<code>"</code><code>ab</code><code>"</code>, 
<code>"</code><code>abb</code><code>"</code>, 
<code>"</code><code>abbcd</code><code>"</code> <br>

<code>"</code><code>AB</code><code>"</code>, 
<code>"</code><code>ABB</code><code>"</code>, 
<code>"</code><code>ABBCD</code><code>"</code></td><td class="c020">
<code>""</code>, 
<code>"</code><code>a</code><code>"</code>, 
<code>"</code><code>acd</code><code>"</code>
</td></tr>
</table>
</div>
<div class="center"><hr class="c022"></div></blockquote><div class="example"><div class="theorem"><span class="c014">Example 38</span>  <em>
</em><em>
</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">       </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">MaxLength</span></span></em><em><span class="c012"> 10 ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">weight</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">decimal</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">MinInclusive</span></span></em><em><span class="c012"> 1 </span></em><em><span class="c012"><span class="c007">MaxInclusive</span></span></em><em><span class="c012"> 200 ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">sku</span></span></em><em><span class="c012">        /^[</span></em><em><span class="c012"><span class="c007">A</span></span></em><em><span class="c012">-</span></em><em><span class="c012"><span class="c007">Z0</span></span></em><em><span class="c012">-9]{10,20}</span></em><em><span class="c012"><span class="c007">$</span></span></em><em><span class="c012">/ ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:product1</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">   </span></em><em><span class="c012"><em><span class="c012">"Product 1"</span></em></span></em><em><span class="c012">;          </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">          </span></em><em><span class="c012">schema:weight</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"23.0"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:decimal</span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">          </span></em><em><span class="c012">schema:sku</span></em><em><span class="c012">    </span></em><em><span class="c012"><em><span class="c012">"A23456B234CBDF"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:product2</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">   </span></em><em><span class="c012"><em><span class="c012">"Product 2"</span></em></span></em><em><span class="c012"> ;         </span></em><span class="c012"><em><span class="c012">#\Fails{:Product} *)    </span></em></span><em><span class="c012">
</span></em><em><span class="c012">          </span></em><em><span class="c012">schema:weight</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"245.5"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:decimal</span></em><em><span class="c012"> ;</span></em><span class="c012"><em><span class="c012"># schema:weight &gt; 200 *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">          </span></em><em><span class="c012">schema:sku</span></em><em><span class="c012">    </span></em><em><span class="c012"><em><span class="c012">"ABC"</span></em></span></em><em><span class="c012"> .               </span></em><span class="c012"><em><span class="c012"># schema:sku fails regex *)</span></em></span></td></tr>
</table><p><a href="https://goo.gl/bBrjbH"><em>Try example in Shaclex</em></a></p></div></div><p><a id="hevea_default382"></a> 
<a id="hevea_default383"></a> <a id="RegularExpressions"></a>
The pattern constraint (‘
<code>/</code><code>regex</code><code>/</code>’) is based on the XPath regular expression function 
<code>fn</code><code>:</code><code>matches</code><code>(</code><code>str</code><code>,</code><code>re</code><code>,</code><code>flags</code><code>)</code> which takes as parameters the string to match, the regular expression, and an optional flags parameter to modify the matching behavior.</p><p><a id="hevea_default384"></a>
XPath regular expressions are based on common conventions from other languages like Perl or other Unix tools like grep.
The regular expression language is a string composed of the characters to match and some characters which have special meaning called <em>meta-characters</em>.</p><ul class="itemize"><li class="li-itemize">
<code>x</code> matches the 
<code>'</code><code>x</code><code>'</code> character.
</li><li class="li-itemize">
<code>\</code><code>u0078</code> matches the unicode codepoint U+78 (which is again 
<code>'</code><code>x</code><code>'</code>).
</li><li class="li-itemize">
<code>.</code> matches any character.
</li><li class="li-itemize">
<code>[</code><code>vxz</code><code>]</code> declares a character class, and matches any of 
<code>'</code><code>v</code><code>'</code>, 
<code>'</code><code>x</code><code>'</code>, or 
<code>'</code><code>z</code><code>'</code>. 
</li><li class="li-itemize">
<code>\</code><code>d</code> is a pre-defined character class which matches any digit.
It is equivalent ot “
<code>[0-9]</code>”.
</li><li class="li-itemize">
<code>\</code><code>S</code> is a pre-defined character class which matches any space character (which also includes tabs and newlines). It is equivalent ot “
<code>[\</code><code>u0008</code><code>\</code><code>u000d</code><code>\</code><code>u000a</code><code>\</code><code>u0020</code><code>]</code>”.
</li></ul><p>Inside character classes, the symbol “
<code>^</code>” means negation and “
<code>-</code>” can be used to declare character ranges.
For instance, the character class 
<code>[^</code><code>a</code><code>-</code><code>zA</code><code>-</code><code>Z</code><code>]</code> matches any non-letter.</p><p>Cardinality (repetition) operators can be used to specify how many characters are matched.
The possibilities are as follows. </p><ul class="itemize"><li class="li-itemize">
<code>?</code> represents zero or one values.
</li><li class="li-itemize">
<code>+</code> one or more values.
</li><li class="li-itemize">
<code>*</code> zero or more values.
</li><li class="li-itemize">
<code>{</code><code>m</code><code>,</code><code>n</code><code>}</code> between 
<code>m</code> and 
<code>n</code> values.</li></ul><p>Any string of characters must be matched in the order of its characters with the following alterations. </p><ul class="itemize"><li class="li-itemize">
<code>|</code> declares alternatives, e.g., “
<code>abc</code><code>|</code><code>def</code><code>|</code><code>ghi</code>” matches any of “
<code>abc</code>”, “
<code>def</code>”, “
<code>ghi</code>”. 
</li><li class="li-itemize">
<code>^</code> matches the beginning of a string.
</li><li class="li-itemize">
<code>$</code> matches the end of a string.
</li><li class="li-itemize">“()” declares a group which is useful for cardinality and alternatives.
For example: “
<code>\^</code><code>ab</code><code>(</code><code>cd</code><code>|</code><code>ef</code><code>){2,}</code><code>gh</code>” matches “
<code>abcdcdcdghij</code>”.
</li></ul><p>All of the meta characters above will be treated as a literal (i.e., they match themselves) if they are prefixed with a 
<code>\\</code> (backslash).</p><p>Table <a href="#ch040regexExamples">4.4</a> contains several examples of regular expression matches.</p><blockquote class="table"><div class="center"><hr class="c022"></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Table 4.4: Examples of regular expressions</td></tr>
</table></div>
<a id="ch040regexExamples"></a> 
<div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c017"> <span class="c014">Regular Expression</span></td><td class="c017"><span class="c014">Some values that match</span></td><td class="c017"><span class="c014">Some values that don’t match
</span></td></tr>
<tr><td class="c017"> 
<code>P</code><code>\</code><code>d</code><code>{2,3}</code></td><td class="c017">
<code>P12</code> 
<code>P234</code></td><td class="c017">
<code>A1</code> 
<code>P2n</code> 
<code>P1</code> 
<code>P2233</code>
</td></tr>
<tr><td class="c017"> 
<code>(</code><code>pa</code><code>)*</code><code>b</code></td><td class="c017">
<code>b</code> 
<code>pab</code> 
<code>papab</code> 
<code>papapab</code> …</td><td class="c017">
<code>pa</code> 
<code>po</code> 
</td></tr>
<tr><td class="c017"> 
<code>(</code><code>pa</code><code>)*</code><code>b</code></td><td class="c017">
<code>b</code> 
<code>pab</code> 
<code>papab</code> 
<code>papapab</code> …</td><td class="c017">
<code>pa</code> 
<code>po</code> 
</td></tr>
<tr><td class="c017"> 
<code>[</code><code>a</code><code>-</code><code>z</code><code>]{2,3}</code></td><td class="c017">
<code>ab</code> 
<code>abc</code></td><td class="c017">
<code>a</code> 
<code>abcd</code> 
<code>23</code> 
</td></tr>
<tr><td class="c017"> 
<code>[</code><code>a</code><code>-</code><code>z</code><code>]{2,3}</code></td><td class="c017">
<code>ab</code> 
<code>abc</code></td><td class="c017">
<code>a</code> 
<code>abcd</code> 
<code>x45</code> 
<code>23</code>
</td></tr>
</table>
</div>
<div class="center"><hr class="c022"></div></blockquote><p>The flags string has the following possibilities. </p><ul class="itemize"><li class="li-itemize"><p><a id="hevea_default385"></a>
</p>
<code>i</code>: Case-insensitive mode. <p><a id="hevea_default386"></a>
</p></li><li class="li-itemize">
<code>m</code>: Multi-line mode.
If present, the 
<code>^</code> character matches the start of any line (not only the start of the string) 
and the <code>$</code> matches the end of any line (not only the end of the string).<p><a id="hevea_default387"></a>
</p></li><li class="li-itemize">
<code>s</code>: If present, the dot matches also newlines, otherwise it matches any character except newlines. 
This mode is called single-line mode in Perl.<p><a id="hevea_default388"></a>
</p></li><li class="li-itemize">
<code>x</code>: Removes white space characters in the regular expression before matching.<p><a id="hevea_default389"></a>
</p></li><li class="li-itemize">
<code>q</code>: All meta characters are interpreted as literals, i.e., they match themselves in the input string.

<code>q</code> is compatible with the 
<code>i</code> flag.
If it’s used with the 
<code>m</code>, 
<code>s</code> or 
<code>x</code> flag, that flag is ignored.
</li></ul><p><a id="hevea_default390"></a>
</p>
<h3 class="subsection" id="sec73">4.5.4  Value Sets</h3>
<p> 
<a id="ch4.sec4.4"></a>
<a id="ch040ValueSets"></a></p><p>A value set is a node constraint which enumerates the list of possible values that a focus node may have.
<a id="hevea_default391"></a> 
In ShExC, value sets are enclosed by square brackets (
<code>[</code> and 
<code>]</code>) where each possible value is separated by a space.</p><div class="example"><div class="theorem"><span class="c014">Example 39</span>  <em>Example with value sets</em><em> 
</em><a id="ch040:exampleValueSets"></a><p><em>The following example declares a shape </em><em>
</em><code><em>:</em></code><code><em>Product</em></code><em> with two properties: </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>color</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>manufacturer</em></code><em>, 
whose possible values are enumerated.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">color</span></span></em><em><span class="c012">        [ </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Red"</span></em></span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Green"</span></em></span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Blue"</span></em></span></span></em><em><span class="c012"> ] ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">manufacturer</span></span></em><em><span class="c012"> [ :</span></em><em><span class="c012"><span class="c007">OurCompany</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">AnotherCompany</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:x1</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:color</span></em><em><span class="c012">        </span></em><em><span class="c012"><em><span class="c012">"Red"</span></em></span></em><em><span class="c012">;         </span></em><span class="c012"><em><span class="c012">#  \Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:manufacturer</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:x2</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:color</span></em><em><span class="c012">        </span></em><em><span class="c012"><em><span class="c012">"Cyan"</span></em></span></em><em><span class="c012"> ;       </span></em><span class="c012"><em><span class="c012">#  \Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:manufacturer</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:x3</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:color</span></em><em><span class="c012">        </span></em><em><span class="c012"><em><span class="c012">"Green"</span></em></span></em><em><span class="c012"> ;      </span></em><span class="c012"><em><span class="c012">#  \Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:manufacturer</span></em><em><span class="c012"> </span></em><em><span class="c012">:Unknown</span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div><p><a id="hevea_default392"></a>
</p>
<h5 class="paragraph" id="sec74">Unit value sets</h5>
<p>A common pattern is to declare that a node must have a specific value. 
This can be done by a unit value set, i.e., a value set with a single value.</p><div class="example"><div class="theorem"><span class="c014">Example 40</span>  <em> 
</em><a id="ch040:exampleSingleSetValues"></a><em>
</em><em>
</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Spanish</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">country</span></span></em><em><span class="c012"> [ :</span></em><em><span class="c012"><span class="c007">Spain</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:country</span></em><em><span class="c012"> </span></em><em><span class="c012">:Spain</span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012"># \Passes{:Spanish} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:country</span></em><em><span class="c012">   </span></em><em><span class="c012">:France</span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012"># \Fails{:Spanish} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012">              </span></em><em><span class="c012">schema:Person</span></em><em><span class="c012"> ; </span></em><span class="c012"><em><span class="c012"># \Passes{:Spanish and :User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:country</span></em><em><span class="c012"> </span></em><em><span class="c012">:Spain</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p1</span></em><em><span class="c012">    </span></em><em><span class="c012">a</span></em><em><span class="c012">              </span></em><em><span class="c012">schema:Product</span></em><em><span class="c012">; </span></em><span class="c012"><em><span class="c012"># \Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:country</span></em><em><span class="c012"> </span></em><em><span class="c012">:Spain</span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012"># \Passes{:Spanish} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">rdf:type</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:Person</span></em><em><span class="c012">;  </span></em><span class="c012"><em><span class="c012"># \Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:country</span></em><em><span class="c012"> </span></em><em><span class="c012">:Japan</span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012"># \Fails{:Spanish} *)</span></em></span></td></tr>
</table></div></div><p>Note that the 
<code>:</code><code>User</code> shape employs the 
<code>a</code> keyword which stands for 
<code>rdf</code><code>:</code><code>type</code>.
There is no inference in ShEx, even for 
<code>rdf</code><code>:</code><code>type</code>, which is treated as any other arc.
See Section <a href="bookHtml009.html#ch030Inference">3.2</a> for a discussion of the difference between shapes and classes.</p><p><a id="hevea_default393"></a>
</p>
<h5 class="paragraph" id="sec75">Language-tagged values</h5>
<p>As seen above, value sets contain one or more values.
The examples so far have included IRI and strings (literals with a datatype of 
<code>xsd</code><code>:</code><code>string</code>).
These match precisely the same value in the data.
They can also be language tags, which match any literal with the given language tag.</p><div class="example"><div class="theorem"><span class="c014">Example 41</span>  <em> 
</em><a id="ch040:exampleSingleValueSets"></a><em>
</em><em>
</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">FrenchProduct</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">label</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">@fr</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">SpanishProduct</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">label</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">@es</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@es</span></span></em><em><span class="c012">-</span></em><em><span class="c012"><span class="c007">AR</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@es</span></span></em><em><span class="c012">-</span></em><em><span class="c012"><span class="c007">ES</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:car1</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Voiture"</span></em></span></em><em><span class="c012">@fr</span></em><em><span class="c012"> .    </span></em><span class="c012"><em><span class="c012"># \Passes{:FrenchProduct} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:car2</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Auto"</span></em></span></em><em><span class="c012">@es</span></em><em><span class="c012"> .    </span></em><span class="c012"><em><span class="c012"># \Passes{:SpanishProduct} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:car3</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carro"</span></em></span></em><em><span class="c012">@es</span></em><em><span class="c012">-</span></em><em><span class="c012">AR</span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012"># \Passes{:SpanishProduct} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:car4</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Coche"</span></em></span></em><em><span class="c012">@es</span></em><em><span class="c012">-</span></em><em><span class="c012">ES</span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012"># \Passes{:SpanishProduct} *)</span></em></span></td></tr>
</table></div></div><p><a id="hevea_default394"></a>
</p>
<h5 class="paragraph" id="sec76">Ranges</h5>
<p> 
<a id="ch040Stems"></a></p><p>We can see in the example above that it would be convenient to accept literals with any language tag starting with 
<code>"</code><code>es</code><code>"</code>.
This can be indicated with the postfix operator ‘
<code>~</code>’.
For example, Argentinian, Chilean, and other region codes for Spain could be accepted with ‘
<code>schema</code><code>:</code><code>label</code><code> [ </code><code>@es</code><code>~ ]</code>’.</p><div class="example"><div class="theorem"><span class="c014">Example 42</span>  <em>Language-tagged ranges</em><em> 
</em><a id="ch040:languageTaggedRanges"></a><p><em>The following code declares that Spanish products contain </em><em>
</em><code><em>rdfs</em></code><code><em>:</em></code><code><em>label</em></code><em> with a value that must be a 
language-tagged literal in Spanish or any variant.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">SpanishProduct</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">label</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">@es</span></span></em><em><span class="c012">~ ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:car1</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Auto"</span></em></span></em><em><span class="c012">@es</span></em><em><span class="c012"> .      </span></em><span class="c012"><em><span class="c012"># \Passes{:SpanishProduct} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:car2</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carro"</span></em></span></em><em><span class="c012">@es</span></em><em><span class="c012">-</span></em><em><span class="c012">AR</span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012"># \Passes{:SpanishProduct} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:car3</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Coche"</span></em></span></em><em><span class="c012">@es</span></em><em><span class="c012">-</span></em><em><span class="c012">ES</span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012"># \Passes{:SpanishProduct} *)</span></em></span></td></tr>
</table></div></div><p>This also works for strings, e.g., ‘
<code>"+34"~</code>’ (French telephone numbers) and 
IRIs, e.g., ‘
<code>&lt;</code><code>http</code><code>://</code><code>www</code><code>.</code><code>w3</code><code>.</code><code>org</code><code>/</code><code>ns</code><code>/&gt;~</code>’ (W3C namespaces).</p><div class="example"><div class="theorem"><span class="c014">Example 43</span>  <em>String and IRI ranges example</em><em> 
</em><a id="ch040:exampleRanges"></a><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">SpanishW3CPeople</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">telephone</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"+34"</span></em></span></span></em><em><span class="c012">~ ] ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">url</span></span></em><em><span class="c012">       [ &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">www</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">W3C</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">es</span></span></em><em><span class="c012">/</span></em><em><span class="c012"><span class="c007">Personal</span></span></em><em><span class="c012">&gt;~ ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:telephone</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"+34 123 456 789"</span></em></span></em><em><span class="c012">; </span></em><span class="c012"><em><span class="c012"># \Passes{:SpanishW3CPeople}*)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:url</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">www</span></em><em><span class="c012">.</span></em><em><span class="c012">W3C</span></em><em><span class="c012">.</span></em><em><span class="c012">es</span></em><em><span class="c012">/</span></em><em><span class="c012">Personal</span></em><em><span class="c012">/</span></em><em><span class="c012">Alice</span></em><em><span class="c012">&gt; .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:telephone</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"123 456 789"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012"># \Fails{:SpanishW3CPeople} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:url</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">other</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/</span></em><em><span class="c012">bob</span></em><em><span class="c012">&gt; .      </span></em><span class="c012"><em><span class="c012"># Bad telephone and url *)</span></em></span></td></tr>
</table></div></div><p>IRIs represented as prefixed names can also have a postfix ‘
<code>~</code>’, e.g., 

<code>foaf</code><code>:~</code> represents the set of all URIs that start with the namespace bound to the prefix 
<code>foaf</code><code>:</code>.</p><div class="example"><div class="theorem"><span class="c014">Example 44</span>  <em> 
</em><a id="ch040:exampleIRIRanges"></a><p><em>In the following example, we declare that the status of a product must start by </em><em>
</em><code><em>http</em></code><code><em>://</em></code><code><em>example</em></code><code><em>.</em></code><code><em>codes</em></code><code><em>/</em></code><code><em>good</em></code><code><em>.</em></code><em> or 
</em><em>
</em><code><em>http</em></code><code><em>://</em></code><code><em>example</em></code><code><em>.</em></code><code><em>codes</em></code><code><em>/</em></code><code><em>bad</em></code><code><em>.</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c007">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">: &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">status</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">good</span></span></em><em><span class="c012">.~ </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bad</span></span></em><em><span class="c012">.~ ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012">codes:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012">other:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">other</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:x1</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012">codes:good</span></em><em><span class="c012">.</span></em><em><span class="c012">Shipped</span></em><em><span class="c012"> .              </span></em><span class="c012"><em><span class="c012"># \Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:x2</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012">other:done</span></em><em><span class="c012"> .                      </span></em><span class="c012"><em><span class="c012"># \Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:x3</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/</span></em><em><span class="c012">bad</span></em><em><span class="c012">.</span></em><em><span class="c012">Lost</span></em><em><span class="c012">&gt; . </span></em><span class="c012"><em><span class="c012"># \Passes{:Product} *)</span></em></span></td></tr>
</table></div></div><p><a id="hevea_default395"></a>
</p>
<h5 class="paragraph" id="sec77">Exclusions</h5>
<p>It can also be useful to exclude some values from a range. 
Exclusions are marked by the minus 
<code>-</code> sign. 
For example: 
<code>codes</code><code>:~ - </code><code>codes</code><code>:</code><code>unknown</code> represents all values starting by 
<code>codes</code><code>:</code> except 
<code>codes</code><code>:</code><code>unknown</code>.</p><p>Exclusions can themselves be ranges. 
For example: 
<code>codes</code><code>:~ - </code><code>codes</code><code>:</code><code>bad</code><code>.~ </code> represents all values starting by 
<code>codes</code><code>:</code> except those that start by 
<code>codes</code><code>:</code><code>bad</code><code>.</code>. </p><div class="example"><div class="theorem"><span class="c014">Example 45</span>  <em>Range exclusions</em><em> 
</em><a id="ch040:exampleIRIRangeExclusion"></a><p><em>The following code prescribes that the status of products can be anything that starts 
with </em><em>
</em><code><em>codes</em></code><code><em>:</em></code><em> 
except </em><em>
</em><code><em>codes</em></code><code><em>:</em></code><code><em>unknown</em></code><em> or codes starting with </em><em>
</em><code><em>codes</em></code><code><em>:</em></code><code><em>bad</em></code><code><em>.</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c007">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">: &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">status</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">:~ - </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">unknown</span></span></em><em><span class="c012"> - </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bad</span></span></em><em><span class="c012">.~ ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012">codes:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012">other:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">other</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p1</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012">codes:good</span></em><em><span class="c012">.</span></em><em><span class="c012">Shipped</span></em><em><span class="c012"> .              </span></em><span class="c012"><em><span class="c012"># \Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p2</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012">other:done</span></em><em><span class="c012"> .                      </span></em><span class="c012"><em><span class="c012"># \Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p3</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/</span></em><em><span class="c012">bad</span></em><em><span class="c012">.</span></em><em><span class="c012">Lost</span></em><em><span class="c012">&gt; . </span></em><span class="c012"><em><span class="c012"># \Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p4</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/</span></em><em><span class="c012">unknown</span></em><em><span class="c012">&gt; .  </span></em><span class="c012"><em><span class="c012"># \Fails{:Product} *)</span></em></span></td></tr>
</table></div></div><p>Exclusions must be the same kind (IRI, string or language tag) as the stem type.
For instance, ‘
<code>[ </code><code>codes</code><code>:</code><code>good</code><code>.~ - "</code><code>bad</code><code>." - </code><code>@fr</code><code>~ ]</code>’ would be malformed as it’s an IRI range excluding a string and a language stem.</p>
<h5 class="paragraph" id="sec78">Heterogeneous value sets</h5>
<p>There is no requirement that value sets be composed of a consistent kind of value (IRI, string or language tag).
For instance, the status of a product can be the IRIs (
<code>:</code><code>Accepted</code> or 
<code>:</code><code>Rejected</code>) or a string, e.g., “unknown".</p><div class="example"><div class="theorem"><span class="c014">Example 46</span>  <em> 
</em><a id="ch040:exampleHeterogeneousValueSet"></a><em>
</em><em>
</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">status</span></span></em><em><span class="c012"> [ :</span></em><em><span class="c012"><span class="c007">Accepted</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">Rejected</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"unknown"</span></em></span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table></div></div>
<h5 class="paragraph" id="sec79">Wildcard stem ranges</h5>
<p>Sometimes we want to accept user data with any value except some specific values.
For this, a wildcard character (‘.’) followed by one or more exclusions can be used (so long as those exclusions are all of the same kind).
The kind of the exlcusions (IRI, string, or language tag) establishes the type of RDF term that will be matched.</p><div class="example"><div class="theorem"><span class="c014">Example 47</span>  <em>Example of a wildcard range with exclusion</em><em> 
</em><a id="ch040:exampleWildcardStemRange"></a><p><em>The following code declares that the status of products can be anything except the IRI </em><em>
</em><code><em>codes</em></code><code><em>:</em></code><code><em>bad</em></code><em>. 
Given that the exclusion is an IRI, the status must be an IRI.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c007">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">: &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">status</span></span></em><em><span class="c012"> [ . - </span></em><em><span class="c012"><span class="c007">codes</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bad</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012">codes:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012">other:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">other</span></em><em><span class="c012">.</span></em><em><span class="c012">codes</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p1</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012">codes:good</span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012"># \Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p2</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012">other:bad</span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012"># \Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p3</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012">codes:bad</span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012"># \Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p4</span></em><em><span class="c012"> </span></em><em><span class="c012">:status</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"good"</span></em></span></em><em><span class="c012"> .     </span></em><span class="c012"><em><span class="c012"># \Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                         </span></em><span class="c012"><em><span class="c012"># "good" must be a IRI *) </span></em></span></td></tr>
</table></div></div>
<h5 class="paragraph" id="sec80">Value set expressivity</h5>
<p>Value sets are mostly a shorthand syntax for complex Boolean combinations of node constraints.
ShEx includes them because they are much more concise and, given their ubiquity in other schema languages, 
they are fundamental to how people model and understand data. </p><div class="example"><div class="theorem"><span class="c014">Example 48</span>  <em>Representing value sets</em><em> 
</em><a id="ch040:representingValueSets"></a><p><em>The following shape:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">gender</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Male</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Female</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>can be defined without value sets using the </em><em>
</em><code><em>OR</em></code><em> operator that will be presented in Section </em><a href="#ch040.LogicalOperatorsShEx"><em>4.6</em></a><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">gender</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Male</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">} </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">gender</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Female</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table></div></div>
<h2 class="section" id="sec81">4.6  Shapes</h2>
<p>
<a id="ch040Shapes"></a>
<a id="ch4.sec5"></a></p><p>In the previous section we explored node constraints and how they declare a set of permissible RDF terms.
Most of the examples used node constraints in triple constraints, 
limiting the permissible values for triples in the input graph.</p><div class="example"><div class="theorem"><span class="c014">Example 49</span>  <em>Simple example</em><p><em>In the following example, we describe a shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>and we will try to validate the nodes </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> represented in the following data:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">alice</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Alice"</span></em></span></span></em><em><span class="c012"> ;  # \</span></em><em><span class="c012"><span class="c007">Passes</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">bob</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bob</span></span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  34 ;       # \</span></em><em><span class="c012"><span class="c007">Fails</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">alice</span></span></em><em><span class="c012"> .   # </span></em><em><span class="c012"><span class="c007">wrong</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> *)</span></em></td></tr>
</table><p><em>To solidify our intuition of validating shapes, we need to think of this as a series of steps to validate a focus node against a shape expression.</em></p><ol class="enumerate" type=1><li class="li-enumerate"><em>Check if focus node </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> conforms to the shape expression </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>.
</em></li><li class="li-enumerate"><em>
</em><code><em>:</em></code><code><em>User</em></code><em> is a shape so check if the neighborhood of </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> matches the triple expression in the shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>.
This step means that one needs to find a way to distribute the triples in the neighborhood to satisfy the triple expression.
</em></li><li class="li-enumerate"><em>The shape’s triple expression is a single triple constraint so all one needs to do is find the triple with a matching predicate in the neighborhood. 
In this case, the triple </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><code><em> </em></code><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><code><em> "</em></code><code><em>Alice</em></code><code><em>"</em></code><em>.
</em></li><li class="li-enumerate"><em>The triple expression has a value expression so consider the object, </em><em>
</em><code><em>"</em></code><code><em>Alice</em></code><code><em>"</em></code><em>, as the focus node and test it against the node constraint (in this case </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em>).
</em></li><li class="li-enumerate"><em>
</em><code><em>"</em></code><code><em>Alice</em></code><code><em>"</em></code><em> matches ‘</em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em>’ so this test succeeds.
</em></li><li class="li-enumerate"><em>The cardinality of the triple constraint is </em><em>
</em><code><em>{1,1}</em></code><em> (the default one) and as there is only one tripe matching the node conforms to the
shape expression.
</em></li></ol><p><em>When the same steps are performed to check </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em>, the last step will have </em><em>
</em><code><em>34</em></code><em> as the focus node.
This test fails so </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> fails to conform to </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>.
</em></p></div></div><p><a id="hevea_default396"></a>
</p>
<h5 class="paragraph" id="sec82">Shape</h5>
<p>
A shape is a container for a triple expression along with some properties stating how to treat triples not matching the triple expression.
We will describe these properties after introducing triple expressions 
(Section <a href="#ch040ClosedExtra">4.6.8</a>).
Since triple expressions are combinations of triple constraints, we start with them.</p>
<h3 class="subsection" id="sec83">4.6.1  Triple Constraints</h3>
<p>
<a id="ch040tripleconstraints"></a>
<a id="ch4.sec5.1"></a></p><p>The basic building block of a triple expression is a triple constraint. 
It is composed of a property, a node constraint, and a cardinality.</p><p>A triple constraint expresses a constraint on the values of triples with the given property and the number of values expressed by the cardinality. 
Cardinalities will be described in more detail in Section <a href="#ch040cardinalities">4.6.3</a>. </p><div class="example"><div class="theorem"><span class="c014">Example 50</span>  <em>
The following shape is defined by a single triple constraint whose components are depicted in Figure </em><a href="#ch040.FigureShExTripleConstraint"><em>50</em></a><em>.</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">productId</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> {1,2}</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em><em>The meaning is that nodes conforming to </em></em><em><em>
</em></em><code><em><em>:</em></em></code><code><em><em>Product</em></em></code><em><em> must satisfy: </em></em></p><ul class="itemize"><li class="li-itemize"><em><em>
</em></em><em><em>They must have property </em></em><em><em>
</em></em><code><em><em>schema</em></em></code><code><em><em>:</em></em></code><code><em><em>productId</em></em></code><em><em>.
</em></em></li><li class="li-itemize"><em><em>All the values of </em></em><em><em>
</em></em><code><em><em>schema</em></em></code><code><em><em>:</em></em></code><code><em><em>productId</em></em></code><em><em> must satisfy the node constraint </em></em><em><em>
</em></em><code><em><em>xsd</em></em></code><code><em><em>:</em></em></code><code><em><em>string</em></em></code><em><em>.
</em></em></li><li class="li-itemize"><em><em>As the cardinality is </em></em><em><em>
</em></em><code><em><em>{1,2}</em></em></code><em><em>, there can be between 1 and 2 values of </em></em><em><em>
</em></em><code><em><em>schema</em></em></code><code><em><em>:</em></em></code><code><em><em>productId</em></em></code><em><em>.
</em></em></li></ul><blockquote class="figure"><div class="center"><hr class="c022"></div><em><em> 
</em></em><div class="center"><em><em>
<img src="ShExTripleConstraint.png">
</em></em></div><em><em>

</em></em><a id="ch040.FigureShExTripleConstraint"></a><em><em>
</em></em><div class="caption"><table class="c002 cellpading0"><tr><td class="c019"><em><em>Figure 4.7: Parts of a triple constraint.</em></em></td></tr>
</table></div><em><em>
</em></em><div class="center"><hr class="c022"></div></blockquote><table class="lstframe c015"><tr><td class="lstlisting"><em><em><span class="c012">:p1</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012">schema:productId</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"P1"</span></em></em></span></em></em><em><em><span class="c012"> .              </span></em></em><em><span class="c012"><em><em><span class="c012"># \Passes{:Product} *)</span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">:p2</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012">schema:productId</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"P2"</span></em></em></span></em></em><em><em><span class="c012">,</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"C2"</span></em></em></span></em></em><em><em><span class="c012">.         </span></em></em><em><span class="c012"><em><em><span class="c012"># \Passes{:Product} *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">:p3</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012">schema:productId</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"P3"</span></em></em></span></em></em><em><em><span class="c012">,</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"C3"</span></em></em></span></em></em><em><em><span class="c012">,</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"X3"</span></em></em></span></em></em><em><em><span class="c012"> .  </span></em></em><em><span class="c012"><em><em><span class="c012"># \Fails{:Product} *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">                                         </span></em></em><em><span class="c012"><em><em><span class="c012"># Cardinality exceeded *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">:p4</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012">schema:name</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"No Id"</span></em></em></span></em></em><em><em><span class="c012"> .                </span></em></em><em><span class="c012"><em><em><span class="c012"># \Fails{:Product} *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">                                         </span></em></em><em><span class="c012"><em><em><span class="c012"># No schema:productId *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">:p5</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012">schema:productId</span></em></em><em><em><span class="c012"> 5 .                 </span></em></em><em><span class="c012"><em><em><span class="c012"># \Fails{:Product} *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">                                         </span></em></em><em><span class="c012"><em><em><span class="c012"># xsd:string not satisfied *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">:p6</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012">schema:productId</span></em></em><em><em><span class="c012"> </span></em></em><em><em><span class="c012"><em><em><span class="c012">"P6"</span></em></em></span></em></em><em><em><span class="c012">,</span></em></em><em><em><span class="c012"> 5  .          </span></em></em><em><span class="c012"><em><em><span class="c012"># \Fails{:Product} *) </span></em></em></span></em><em><em><span class="c012">
</span></em></em><em><em><span class="c012">                                         </span></em></em><em><span class="c012"><em><em><span class="c012"># xsd:string not satisfied *) </span></em></em></span></em></td></tr>
</table></div></div><p><a id="hevea_default397"></a>
</p>
<h5 class="paragraph" id="sec84">Closing a property</h5>
<p> 
<a id="ch040ClosingProperty"></a>
Triple constraints have an implicit meaning of closing the possible values of a property.
In the previous example, the declaration 
<code>schema</code><code>:</code><code>productId</code><code> </code><code>xsd</code><code>:</code><code>string</code> requires all values of 
<code>schema</code><code>:</code><code>productId</code> to satisfy 
<code>xsd</code><code>:</code><code>string</code>. 
That’s why 
<code>:</code><code>p6</code> failed to conform: although it had one string value, the other value wasn’t.</p><p>This behavior can be modified with the directives 
<code>EXTRA</code> and 
<code>CLOSED</code> that will be shown in Section <a href="#ch040ClosedExtra">4.6.8</a>.</p><p><a id="hevea_default398"></a>
</p>
<h3 class="subsection" id="sec85">4.6.2  Groupings</h3>
<p> 
<a id="ch040grouping"></a>
<a id="ch4.sec5.2"></a></p><p>The EachOf operator combines two or more triple expressions.
All the sub-expressions must be satisfied by triples in the neighborhood of the focus node.
EachOf is indicated by a semicolon (
<code>;</code>) in the compact syntax.</p><div class="example"><div class="theorem"><span class="c014">Example 51</span>  <em>
A </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> is defined by an EachOf expression that combines three triple constraints.
A node satisfies the </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> type if all the three triple constraints are satisfied.
</em><em>
</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">foaf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">age</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">integer</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">email</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table></div></div>
<h3 class="subsection" id="sec86">4.6.3  Cardinalities</h3>
<p> 
<a id="ch040cardinalities"></a>
<a id="ch4.sec5.3"></a></p><p><a id="hevea_default399"></a>
Cardinalities indicate the required number of triples satisfying the given constraint.
They are most often used on triple constraints although they can also be applied to more complex expressions. 
Table <a href="#ch040.Cardinalities">4.5</a> gives an overview of the different representations of cardinalities in ShExC.</p><blockquote class="table"><div class="center"><hr class="c022"></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Table 4.5: ShEx cardinalities</td></tr>
</table></div>
<a id="ch040.Cardinalities"></a> 
<div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c016"> <span class="c014">Value</span></td><td class="c016"><span class="c014">Description
</span></td></tr>
<tr><td class="c016"> 
<code>*</code></td><td class="c016">0 or more
</td></tr>
<tr><td class="c016"> 
<code>+</code></td><td class="c016">1 or more 
</td></tr>
<tr><td class="c016"> 
<code>?</code></td><td class="c016">0 or 1
</td></tr>
<tr><td class="c016"> 
<code>{</code><code>m</code><code>}</code></td><td class="c016">Exactly <span class="c013">m</span> repetitions 
</td></tr>
<tr><td class="c016"> 
<code>{</code><code>m</code><code>,</code><code>n</code><code>}</code></td><td class="c016">Between <span class="c013">m</span> and <span class="c013">n</span> repetitions
</td></tr>
<tr><td class="c016"> 
<code>{</code><code>m</code><code>,}</code></td><td class="c016"><span class="c013">m</span> or more repetitions </td></tr>
</table>
</div>
<div class="center"><hr class="c022"></div></blockquote><p>If the cardinality is not specified, the default value is 
<code>{1}</code> (exactly one).</p><div class="example"><div class="theorem"><span class="c014">Example 52</span>  <em>Cardinalities example</em><em> 
</em><a id="ch040:exampleCardinalities"></a><p><em>The following </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> shape declares that nodes must have exactly one value for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> (default cardinality), 
and optional value for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> and zero or more values for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>follows</em></code><em>.</em></p><p><em>The </em><em>
</em><code><em>:</em></code><code><em>Company</em></code><em> shape uses the explicit </em><em>
</em><code><em>{</em></code><code><em>m</em></code><code><em>,</em></code><code><em>n</em></code><code><em>}</em></code><em> syntax to assert that a matching node must have between 1 and 100 employees and 
an optional </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>founder</em></code><em> value.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> ? ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">follows</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> *</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">founder</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> ?;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">employee</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> {1,100}</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;       </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:follows</span></em><em><span class="c012">  </span></em><em><span class="c012">:bob</span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012">.</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">        </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;     </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012">.</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;      </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:follows</span></em><em><span class="c012">  </span></em><em><span class="c012">:alice</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:emily</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Emily"</span></em></span></em><em><span class="c012"> ;      </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany,</span></em><em><span class="c012">   </span></em><span class="c012"><em><span class="c012"># more than one schema:worksFor *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                            </span></em><em><span class="c012">:OtherCompany</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:founder</span></em><em><span class="c012">  </span></em><em><span class="c012">:dave</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:employee</span></em><em><span class="c012"> </span></em><em><span class="c012">:alice,</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012">.  </span></em><span class="c012"><em><span class="c012">#\Passes{:Company} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:OtherCompany</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:founder</span></em><em><span class="c012"> </span></em><em><span class="c012">:alice</span></em><em><span class="c012"> .      </span></em><span class="c012"><em><span class="c012">#\Fails{:Company} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                                           </span></em><span class="c012"><em><span class="c012"># 0 employees *)</span></em></span></td></tr>
</table></div></div><p>A cardinality can also be used on more general expressions indicating that the neighborhood of a node must contain several groups of triples, each of them satisfying the expression.</p><div class="example"><div class="theorem"><span class="c014">Example 53</span>  <em>Cardinalities on expressions</em><em> 
</em><a id="ch040:cardinalitiesExmpressions"></a><p><em>The following shape declares that nodes must have exactly one value for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> 
and that they can contain the combination of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>givenName</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>familyName</em></code><em> with optional cardinality (either they contain the group of both properties or none of them).</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> ( </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ) ?</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">       </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">            .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">        </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Smith"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div>
<h3 class="subsection" id="sec87">4.6.4  Choices</h3>
<p> 
<a id="ch040oneOf"></a>
<a id="ch4.sec5.4"></a>
<a id="hevea_default400"></a>
</p><p>The pipe or choice operator 
<code>|</code> can be used to declare compose complex triple expressions with the meaning that <em>one of</em> the branches must be satisfied.</p><div class="example"><div class="theorem"><span class="c014">Example 54</span>  <em>OneOf operator</em><em> 
</em><a id="ch040:exampleOneOf"></a><p><em>The following shape declares that nodes must have either </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> or </em><em>
</em><code><em>foaf</em></code><code><em>:</em></code><code><em>name</em></code><em>, but not both.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> |</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">foaf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">foaf:name</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"Bob"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:identifier</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"P234"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">foaf:name</span></em><em><span class="c012">         </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012"># More than one *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:identifier</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"P123"</span></em></span></em><em><span class="c012"> .   </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                                    </span></em><span class="c012"><em><span class="c012"># None provided *)</span></em></span></td></tr>
</table></div></div><p>A typical pattern consists of combining OneOf (
<code>|</code> operator) with EachOf (
<code>;</code>) to form more complex expressions.</p><div class="example"><div class="theorem"><span class="c014">Example 55</span>  <em> 
</em><a id="ch040:exampleChoices"></a><p><em>The following shape declares that nodes must have either one </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> or a combination of zero or more </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>givenName</em></code><em> and
one </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>lastName</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> |</span></em><em><span class="c012">
</span></em><em><span class="c012">  ( </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> + ;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">  )</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">
</span></em><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Bob"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Bobby"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Smith"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"King"</span></em></span></em><em><span class="c012"> .   </span></em><span class="c012"><em><span class="c012"># Can't have both *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">        23 .      </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                                    </span></em><span class="c012"><em><span class="c012"># schema:name must be xsd:string *)</span></em></span></td></tr>
</table></div></div><p>A typical pattern is to add some cardinality to an expression formed by the OneOf (
<code>|</code>) operator.</p><div class="example"><div class="theorem"><span class="c014">Example 56</span>  <em>Cardinality on OneOf expression</em><em> 
</em><a id="ch040:cardinalitiesExmpressionsOneOf"></a><p><em>The following shape declares that nodes must have exactly one value for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>productId</em></code><em> 
and that they can contain between 0 or two combinations of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>isRelatedTo</em></code><em> or </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>isSimilarTo</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">productId</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> ( </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">isRelatedTo</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> |</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">isSimilarTo</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> ){0,2}</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:p1</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"P1"</span></em></span></em><em><span class="c012"> ;           </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:isRelatedTo</span></em><em><span class="c012"> </span></em><em><span class="c012">:p2,</span></em><em><span class="c012"> </span></em><em><span class="c012">:p3</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p2</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"P2"</span></em></span></em><em><span class="c012"> .           </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p3</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"P3"</span></em></span></em><em><span class="c012">;            </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:isRelatedTo</span></em><em><span class="c012"> </span></em><em><span class="c012">:p1</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:isSimilarTo</span></em><em><span class="c012"> </span></em><em><span class="c012">:p2</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p4</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"P4"</span></em></span></em><em><span class="c012"> ;           </span></em><span class="c012"><em><span class="c012">#\Fails{:Product} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:isRelatedTo</span></em><em><span class="c012"> </span></em><em><span class="c012">:p1,</span></em><em><span class="c012"> </span></em><em><span class="c012">:p2,</span></em><em><span class="c012"> </span></em><em><span class="c012">:p3</span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div>
<h3 class="subsection" id="sec88">4.6.5  Nested Shapes</h3>
<p>
<a id="ch4.sec5.5"></a>
<a id="hevea_default401"></a></p><p>It is possible to avoid defining two shapes when one of them is just an auxiliary shape that is not needed elsewhere. </p><div class="example"><div class="theorem"><span class="c014">Example 57</span>  <em> 
</em><a id="ch040:NestedShapes"></a><p><em>The following schema declares that nodes conforming with </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> must have a property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> with </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> and another property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> whose value must conform with an anonymous shape </em><em>
</em><code><em>_</em></code><code><em>:1</em></code><em> which must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> with the value </em><em>
</em><code><em>:</em></code><code><em>Company</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@_</span></span></em><em><span class="c012">:1</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c007">_</span></span></em><em><span class="c012">:1 { </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ :</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> ] }</span></em></td></tr>
</table><p><em>It can be rewritten as:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ :</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012">]</span></em><em><span class="c012">
</span></em><em><span class="c012">  }</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;           </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;          </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> [ </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:Company</span></em><em><span class="c012">] .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;           </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> [               </span></em><span class="c012"><em><span class="c012"># The value of schema:worksFor *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">         </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"AnotherCompany"</span></em></span></em><em><span class="c012">  </span></em><span class="c012"><em><span class="c012"># does not have rdf:type :Company *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       ].</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:Company</span></em><em><span class="c012"> .               </span></em><span class="c012"><em><span class="c012">#\Passes{anonymous shape} *)</span></em></span></td></tr>
</table></div></div><p><a id="hevea_default402"></a>
Nested shapes can be used to emulate simple SPARQL property paths.</p><div class="example"><div class="theorem"><span class="c014">Example 58</span>  <em> 
</em><a id="ch040:NestedShapesPropertyPaths"></a><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Grandson</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">parent</span></span></em><em><span class="c012"> { :</span></em><em><span class="c012"><span class="c007">parent</span></span></em><em><span class="c012"> . + }+ ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">:parent</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob,</span></em><em><span class="c012"> </span></em><em><span class="c012">:carol</span></em><em><span class="c012"> .  </span></em><span class="c012"><em><span class="c012">#\Passes{:Grandson} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">:parent</span></em><em><span class="c012"> </span></em><em><span class="c012">:dave</span></em><em><span class="c012">.          </span></em><span class="c012"><em><span class="c012">#\Passes{:Grandson} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">:parent</span></em><em><span class="c012"> </span></em><em><span class="c012">:emily</span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012">#\Fails{:Grandson} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">:parent</span></em><em><span class="c012"> </span></em><em><span class="c012">:grace</span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012">#\Fails{:Grandson} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:emily</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Emily"</span></em></span></em><em><span class="c012"> .   </span></em><span class="c012"><em><span class="c012">#\Fails{:Grandson} *)</span></em></span></td></tr>
</table></div></div>
<h3 class="subsection" id="sec89">4.6.6  Inverse Triple Constraints</h3>
<p>
<a id="ch4.sec5.6"></a>
<a id="hevea_default403"></a></p><p>The 
<code>^</code> operator reverses the order of the triple constraint. 
Instead of constraining the focus node’s outgoing arcs, it constrains incoming arcs.</p><div class="example"><div class="theorem"><span class="c014">Example 59</span>  <em>Inverse triple constraints</em><em> 
</em><a id="ch040:InverseTripleConstraints"></a><p><em>The following code declares that nodes conforming to shape </em><em>
</em><code><em>:</em></code><code><em>Company</em></code><em> must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> </em><em>
</em><code><em>:</em></code><code><em>Company</em></code><em> and must be the objects of
one or more triples with predicate </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> and a subject conforming to shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [</span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012">] ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> ^</span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> +</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>With the following data, node </em><em>
</em><code><em>:</em></code><code><em>Company1</em></code><em> conforms to </em><em>
</em><code><em>:</em></code><code><em>Company</em></code><em> because there are two nodes, </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> that work for it. 
However, node </em><em>
</em><code><em>:</em></code><code><em>Company2</em></code><em> does not conform because there are no node pointing to it by the property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> and
node </em><em>
</em><code><em>:</em></code><code><em>Company3</em></code><em> also fails because the node that works for it, does not conform to shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;        </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:Company1</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Bob"</span></em></span></em><em><span class="c012"> ;           </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:Company1</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:Company3</span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                                   </span></em><span class="c012"><em><span class="c012"># No schema:name *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:Company1</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Company</span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012">#\Passes{:Company} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:Company2</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Company</span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012">#\Fails{:Company} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                                   </span></em><span class="c012"><em><span class="c012"># No one works for it *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:Company3</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Company</span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012">#\Fails{:Company} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                                   </span></em><span class="c012"><em><span class="c012"># Carol works for it *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                                   </span></em><span class="c012"><em><span class="c012"># but does not conform to User *)</span></em></span></td></tr>
</table></div></div>
<h3 class="subsection" id="sec90">4.6.7  Repeated Properties</h3>
<p>
<a id="ch4.sec5.7"></a>
<a id="ch040.RepeatedPropertiesSection"></a></p><p><a id="hevea_default404"></a>
The EachOf operator is different from a conjunction operator.
This is best illustrated when a shape uses the same property several times; we call this a <em>repeated property</em>.
In Example <a href="#ch040%3ARepeatedProperties">60</a>, the 
<code>:</code><code>User</code> shape is an EachOf with three triple constraints, two of which have the same property 
<code>:</code><code>parent</code>.
This shape is conformed by a node that has two arcs for the 
<code>:</code><code>parent</code> property, 
each of which contributes to satisfy one of the two triple constraints. </p><div class="example"><div class="theorem"><span class="c014">Example 60</span>  <em>Repeated properties</em><em> 
</em><a id="ch040:RepeatedProperties"></a><em>
</em><em>
</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">parent</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">gender</span></span></em><em><span class="c012"> [</span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Male</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012"> } ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">parent</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">gender</span></span></em><em><span class="c012"> [</span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Female</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012"> } ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">   </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;        </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:parent</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob,</span></em><em><span class="c012"> </span></em><em><span class="c012">:carol</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Male</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Female</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">   </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012"> ;         </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:parent</span></em><em><span class="c012"> </span></em><em><span class="c012">:carol,</span></em><em><span class="c012"> </span></em><em><span class="c012">:emily</span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012"># both parents are Female</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:emily</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Female</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:frank</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Frank"</span></em></span></em><em><span class="c012">;           </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:parent</span></em><em><span class="c012"> </span></em><em><span class="c012">:x</span></em><em><span class="c012"> .                   </span></em><span class="c012"><em><span class="c012"># only one parent</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:x</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:gender</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Female,</span></em><em><span class="c012">
</span></em><em><span class="c012">                     </span></em><em><span class="c012">schema:Male</span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>Remember that ShEx distributes the triples to triple constraints in a triple expression (see Section </em><a href="#ch040Shapes"><em>4.6</em></a><em>).
This means the same triple cannot contribute for satisfying two different triple constraints, 
even if its object satisfies the node constraints for both.
That is why the node </em><em>
</em><code><em>:</em></code><code><em>frank</em></code><em> does not conform to the </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> shape even if its parent satisfies both conditions.</em></p></div></div>
<h3 class="subsection" id="sec91">4.6.8  Permitting other Triples</h3>
<p> 
<a id="ch040ClosedExtra"></a>
<a id="ch4.sec5.8"></a>
<a id="hevea_default405"></a></p><p>When defining RDF-based services using ShEx schemas, there are several possibilities that have to be taken into account.
Some services backed by an RDF triple store may simply accept and store any triples not described in the schema; 
in such a case, the role of the schema is mainly to identify and constrain the triples that the service understands and manipulates, 
allowing any extra triples for unforeseen applications.
This <em>open</em> model is more popular in the semantic web community.</p><p>At the other extreme, some services or databases may accept or emit some fixed structure, 
disallowing any triples that are not mentioned in the schema. 
In this case, the role of ShEx schemas is to validate and verify the content before it is processed or published. 
This <em>closed</em> model has been traditionally employed in contexts where data quality and security play a significant part.</p><p>ShEx manages these use cases with two granularities:</p><ul class="itemize"><li class="li-itemize">
<em>extra properties</em> manage triples with predicates that appear in the shape expression but do not have corresponding values; and 
</li><li class="li-itemize"><em>closed shapes</em> manage triples with predicates that <em>do not</em> appear in the shape expression.
</li></ul>
<h4 class="subsubsection" id="sec92">Extra Properties</h4>
<p> 
<a id="ch040ShExExtra"></a>
<a id="hevea_default406"></a></p><p>As we described in Section <a href="#ch040ClosingProperty">4.6.1</a> triple constraints close properties by default.
Sometimes, it is useful to <em>open</em> a property to permit instances of it which are not included in the schema. 
The 
<code>EXTRA</code> qualifier can be used to allow the appearance of other properties. </p><p>A shape of the form 

</p><table class="lstframe c015"><tr><td class="lstlisting"><span class="c012">&lt;</span><span class="c012"><span class="c007">Shape</span></span><span class="c012">&gt; </span><span class="c012"><span class="c007">EXTRA</span></span><span class="c012"> &lt;</span><span class="c012"><span class="c007">property</span></span><span class="c012">&gt; {</span><span class="c012">
</span><span class="c012"> &lt;</span><span class="c012"><span class="c007">property</span></span><span class="c012">&gt; &lt;</span><span class="c012"><span class="c007">NodeConstraint</span></span><span class="c012">&gt;</span><span class="c012">
</span><span class="c012">}</span></td></tr>
</table><p>is equivalent to:</p><table class="lstframe c015"><tr><td class="lstlisting"><span class="c012">&lt;</span><span class="c012"><span class="c007">Shape</span></span><span class="c012">&gt; {</span><span class="c012">
</span><span class="c012"> &lt;</span><span class="c012"><span class="c007">property</span></span><span class="c012">&gt; &lt;</span><span class="c012"><span class="c007">NodeConstraint</span></span><span class="c012">&gt; ;</span><span class="c012">
</span><span class="c012"> &lt;</span><span class="c012"><span class="c007">property</span></span><span class="c012">&gt; (</span><span class="c012"><span class="c007">Not</span></span><span class="c012"> &lt;</span><span class="c012"><span class="c007">NodeConstraint</span></span><span class="c012">&gt;)*</span><span class="c012">
</span><span class="c012">}</span></td></tr>
</table><p>which means that it allows zero or more values of 
<code>&lt;</code><code>property</code><code>&gt;</code> that do not satisfy 
<code>&lt;</code><code>NodeConstraint</code><code>&gt;</code>. 
<a id="hevea_default407"></a>
Note that that there is a hidden negation in any shape that includes an 
<code>EXTRA</code> qualifier.</p><div class="example"><div class="theorem"><span class="c014">Example 61</span>  <em>EXTRA example</em><em> 
</em><a id="ch040:exampleEXTRA"></a><p><em>The following example declares that nodes that conform to </em><em>
</em><code><em>:</em></code><code><em>FollowSpaniards</em></code><em> must follow one of more nodes whose nationality is </em><em>
</em><code><em>:</em></code><code><em>Spain</em></code><em>, but can also follow other nodes.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">FollowSpaniards</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">EXTRA</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">follows</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">follows</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">nationality</span></span></em><em><span class="c012"> [:</span></em><em><span class="c012"><span class="c007">Spain</span></span></em><em><span class="c012">] }+</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">alice</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">follows</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">david</span></span></em><em><span class="c012"> .         #\</span></em><em><span class="c012"><span class="c007">Passes</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">FollowSpaniards</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bob</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">follows</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">david</span></span></em><em><span class="c012">, :</span></em><em><span class="c012"><span class="c007">emily</span></span></em><em><span class="c012"> .   #\</span></em><em><span class="c012"><span class="c007">Passes</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">FollowSpaniards</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">carol</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">follows</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">emily</span></span></em><em><span class="c012"> .         #\</span></em><em><span class="c012"><span class="c007">Fails</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">FollowSpaniards</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">david</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">nationality</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">Spain</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">emily</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">nationality</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">France</span></span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>Notice that in the case of </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> is passes although it follows </em><em>
</em><code><em>:</em></code><code><em>emily</em></code><em> which is not Spaniard.
If we remove the </em><em>
</em><code><em>EXTRA</em></code><em> declaration it would fail.</em></p></div></div><p>A typical pattern using 
<code>EXTRA</code> declarations is to constrain the set of required values of a node but to allow other values.</p><div class="example"><div class="theorem"><span class="c014">Example 62</span>  <em>EXTRA properties with several types</em><em> 
</em><a id="ch040:exampleEXTRATypes"></a><p><a id="hevea_default408"></a><em>
The following example declares the shapes for companies which must have two values for the </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> predicate: 
</em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Organization</em></code><em> and </em><em>
</em><code><em>org</em></code><code><em>:</em></code><code><em>Organization</em></code><em>. 
Shape </em><em>
</em><code><em>:</em></code><code><em>Company1</em></code><em> does not allow any extra </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> arc, while shape </em><em>
</em><code><em>:</em></code><code><em>Company2</em></code><em> allows extra values.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company1</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Organization</span></span></em><em><span class="c012"> ] ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Organization</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company2</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">EXTRA</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> {                # </span></em><em><span class="c012"><span class="c007">Allows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">extra</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">values</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">of</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">type</span></span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Organization</span></span></em><em><span class="c012"> ] ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Organization</span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:OurCompany</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">org:Organization,</span></em><em><span class="c012">     </span></em><span class="c012"><em><span class="c012">#\Passes{:Company1 and :Company2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">              </span></em><em><span class="c012">schema:Organization</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:OurUniversity</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">org:Organization,</span></em><em><span class="c012">            </span></em><span class="c012"><em><span class="c012">#\Fails{:Company1} *)  </span></em></span><em><span class="c012">
</span></em><em><span class="c012">                 </span></em><em><span class="c012">schema:CollegeOrUniversity,</span></em><em><span class="c012">  </span></em><span class="c012"><em><span class="c012"># unexpected rdf:type</span></em></span><em><span class="c012">
</span></em><em><span class="c012">                 </span></em><em><span class="c012">schema:Organization</span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012">#\Passes{:Company2} *)   </span></em></span></td></tr>
</table></div></div>
<h4 class="subsubsection" id="sec93">Closed Shapes</h4>
<p>
<a id="ch040:SecClosedShapes"></a></p><p><a id="hevea_default409"></a>
A shape can be declared to have only the triples matching a given set of triple constraints and no others using the 
keyword 
<code>CLOSED</code>. </p><div class="example"><div class="theorem"><span class="c014">Example 63</span>  <em>CLOSED shape example</em><em> 
</em><a id="ch040:exampleClosed"></a><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User1</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User2</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">CLOSED</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Passes{:User1 and :User2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">    </span></em><em><span class="c012"><em><span class="c012">"Bob"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Passes{:User1} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012">   </span></em><em><span class="c012">:alice</span></em><em><span class="c012"> ;   </span></em><span class="c012"><em><span class="c012">#\Fails{:User2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:age</span></em><em><span class="c012">     23 .       </span></em><span class="c012"><em><span class="c012">#  unexpected schema:age</span></em></span></td></tr>
</table></div></div><p><a id="hevea_default410"></a>
<a id="hevea_default411"></a>
A common pattern is to combine 
<code>CLOSED</code> and 
<code>EXTRA</code>. </p><div class="example"><div class="theorem"><span class="c014">Example 64</span>  <em>CLOSED shapes</em><em> 
</em><a id="ch040:exampleClosedExtra"></a><p><em>The shape </em><em>
</em><code><em>KnowsW3CPeople</em></code><em> </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">KnowsW3CPeople</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">CLOSED</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">EXTRA</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">affiliation</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> ? ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">affiliation</span></span></em><em><span class="c012"> [:</span></em><em><span class="c012"><span class="c007">W3C</span></span></em><em><span class="c012">] }+</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">        </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Passes{:KnowsW3CPeople} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:affiliation</span></em><em><span class="c012"> </span></em><em><span class="c012">:ACompany</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012">       </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">        </span></em><em><span class="c012"><em><span class="c012">"Bob"</span></em></span></em><em><span class="c012"> ;      </span></em><span class="c012"><em><span class="c012">#\Fails{:KnowsW3CPeople} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:affiliation</span></em><em><span class="c012"> </span></em><em><span class="c012">:W3C</span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012">       </span></em><em><span class="c012">:carol</span></em><em><span class="c012"> .     </span></em><span class="c012"><em><span class="c012"># :carol's affiliation is not :W3C *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">        </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Passes{:KnowsW3CPeople} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:affiliation</span></em><em><span class="c012"> </span></em><em><span class="c012">:ACompany</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012">       </span></em><em><span class="c012">:alice,</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012"> ;           </span></em><span class="c012"><em><span class="c012">#\Fails{:KnowsW3CPeople} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> </span></em><em><span class="c012">:alice,</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:age</span></em><em><span class="c012">   23 .               </span></em><span class="c012"><em><span class="c012"># schema:age not allowed*)</span></em></span></td></tr>
</table><p><a href="https://goo.gl/mdkMWQ"><em>Try example in Shaclex</em></a></p></div></div>
<h2 class="section" id="sec94">4.7  References</h2>
<p>
<a id="ch4.sec6"></a></p>
<h3 class="subsection" id="sec95">4.7.1  Shape References</h3>
<p>
<a id="ch4.sec6.1"></a>
<a id="ch040:ShapeReference"></a>
<a id="hevea_default412"></a></p><p>A node constraint can be a shape reference, which has the form 
<code>@label</code> where label is the identifier of another shape expression in the schema. 
<em>Shape expression reference</em> would be a more precise name but is long enough to be awkard.</p><div class="example"><div class="theorem"><span class="c014">Example 65</span>  <em>Shape references</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:User</span></em><em><span class="c012">;             </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:a</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:User</span></em><em><span class="c012">;             </span></em><span class="c012"><em><span class="c012">#\Fails{:User because :x fails as :Company} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:x</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"CompanyA"</span></em></span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Passes{:Company} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:x</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> 23 .        </span></em><span class="c012"><em><span class="c012">#\Fails{:Company} *)</span></em></span></td></tr>
</table></div></div>
<h3 class="subsection" id="sec96">4.7.2  Recursion and Cyclic References</h3>
<p> 
<a id="ch4.sec6.2"></a>
<a id="ch040:CyclicReferences"></a></p><p><a id="hevea_default413"></a> <a id="hevea_default414"></a>
It is possible to define data models with cyclic references, i.e., shapes that recursively refer to themselves either directly or indirectly. 
ShEx supports these kinds of data models which appear frequently. </p><div class="example"><div class="theorem"><span class="c014">Example 66</span>  <em>Cyclic data model</em><p><em>The model depicted in Figure </em><a href="#ch040.CyclicModel"><em>66</em></a><em> can be specified in ShEx as:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">employee</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><blockquote class="figure"><div class="center"><hr class="c022"></div><em> 
</em><div class="center"><em>
<img src="CyclicModel.png">
</em></div><em>

</em><a id="ch040.CyclicModel"></a><em>
</em><div class="caption"><table class="c002 cellpading0"><tr><td class="c019"><em>Figure 4.8: Example of cyclic data model.</em></td></tr>
</table></div><em>
</em><div class="center"><hr class="c022"></div></blockquote><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> .           </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012">;                     </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:AnotherCompany</span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)  </span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"OurCompany"</span></em></span></em><em><span class="c012"> ;         </span></em><span class="c012"><em><span class="c012">#\Passes{:Company} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:employee</span></em><em><span class="c012"> </span></em><em><span class="c012">:alice,</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:AnotherCompany</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"AnotherCompany"</span></em></span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Passes{:Company} *) </span></em></span></td></tr>
</table></div></div><div class="example"><div class="theorem"><span class="c014">Example 67</span>  <em>More complex cyclic model</em><p><em>As an exercise, we present a more complex cyclic data model in 
Figure </em><a href="#ch040.CyclicModelExercise"><em>67</em></a><em>.
Although the model has several cycles, it can be easily represented in ShEx as:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">University</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">      </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">employee</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012"> +;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">course</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012"> +</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">           [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> ];</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">teaches</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">university</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">University</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">hasStudent</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Student</span></span></em><em><span class="c012">+</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Student</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">            [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> ];</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">mbox</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">hasFriend</span></span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Student</span></span></em><em><span class="c012">* ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">isEnroledIn</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><blockquote class="figure"><div class="center"><hr class="c022"></div><em> 
</em><div class="center"><em>
<img src="CyclicModelExercise.png">
</em></div><em>

</em><a id="ch040.CyclicModelExercise"></a><em>
</em><div class="caption"><table class="c002 cellpading0"><tr><td class="c019"><em>Figure 4.9: Exercise to represent cyclic data model.</em></td></tr>
</table></div><em>
</em><div class="center"><hr class="c022"></div></blockquote><p><em>Notice the separation between the types and shapes of nodes.
Both </em><em>
</em><code><em>:</em></code><code><em>Teacher</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>Student</em></code><em> must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> with value </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Person</em></code><em>, but their properties are different.
</em></p></div></div><p>As can be seen, ShEx can model any kind cyclic or recursive model in a natural way. 
The only restriction is when combining recursion with negation, as we will explain in Section <a href="#ch040ShExNegation">4.8.3</a> where the negation operator 
<code>NOT</code> is introduced. </p>
<h3 class="subsection" id="sec97">4.7.3  External Shapes</h3>
<p>
<a id="ch4.sec6.3"></a>
<a id="ch040.ExternalShapes"></a>
<a id="hevea_default415"></a></p><p>External shapes are an extension mechanism to externally define shapes. 
This is useful when we want to describe functional shapes or very large value sets.
As a practical example, in medical schemas, value sets can be dynamically derived and include hundreds of thousands of terms.
In the FHIR use case (see Section <a href="bookHtml012.html#ch060FHIR">6.2</a>), these are resolved using an emerging REST API for ShEx.</p><div class="example"><div class="theorem"><span class="c014">Example 68</span>  <em>External shape example</em><p><em>The following code declares an external shape for products where the value of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>category</em></code><em> is defined as an external shape. 
In this case, an annotation declares the property </em><em>
</em><code><em>:</em></code><code><em>service</em></code><em> that points to the URL where the shape can be retrieved.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">productId</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">category</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">EXTERNAL</span></span></em><em><span class="c012"> // :</span></em><em><span class="c012"><span class="c007">service</span></span></em><em><span class="c012"> &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">categories</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>Although at the time of this writing, 
the ShEx specification does not define a mechanism like the </em><em>
</em><code><em>:</em></code><code><em>service</em></code><em> above, it is expected that future mechanisms 
like that will be developed.</em></p></div></div><p><a id="hevea_default416"></a>
</p>
<h3 class="subsection" id="sec98">4.7.4  Labeled Triple Expression</h3>
<p>
<a id="ch4.sec6.4"></a></p><p>Much as shape references (Section <a href="#ch040%3AShapeReference">4.7.1</a>) are allowed wherever a shape expression may appear, any triple expression can be labeled so it can later be referenced.</p><p>The target triple expression must be labeled with <code>$label</code> and references are made with <code>&amp;label</code>.</p><p>For instance, if we want to share a name expression between 
<code>:</code><code>User</code> and 
<code>:</code><code>Employee</code> shapes, we could include the expression in one and reference it from the other.</p><div class="example"><div class="theorem"><span class="c014">Example 69</span>  <em>Labeled triple expression</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">$</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> ( </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">        | </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012"> . ;</span></em><em><span class="c012">
</span></em><em><span class="c012">          </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">        ) ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">email</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Employee</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  &amp;:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">employeeId</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;                  </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:email</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">mailto:alice@example</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">&gt; .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;           </span></em><span class="c012"><em><span class="c012">#\Passes{:Employee} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Smith"</span></em></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">:employeeId</span></em><em><span class="c012"> 1234567 .</span></em></td></tr>
</table></div></div><p>The “
<code>\&amp;:</code><code>name</code>" directive can be considered to insert the value of 
<code>:</code><code>name</code> into its place.
Logically, 
<code>:</code><code>Employee</code> is equivalent to this:</p><div class="example"><div class="theorem"><span class="c014">Example 70</span>  <em>Equivalent triple expression</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Employee</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  ( </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">  | </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012"> . ;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012"> .) ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  :</span></em><em><span class="c012"><span class="c007">employeeId</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table></div></div>
<h3 class="subsection" id="sec99">4.7.5  Annotations</h3>
<p> 
<a id="ch040Annotations"></a>
<a id="ch4.sec6.5"></a>
<a id="hevea_default417"></a></p><p>ShEx allows to provide annotations, which are lists of pairs 
<code>(</code><code>predicate</code><code>,</code><code>object</code><code>)</code> where predicate is an IRI and object is any RDF node.
Annotations provide additional information about the elements to that they are applied, which can be 
triple constraints, EachOf, OneOf, or shapes. </p><p>The compact syntax for annotations uses two slashes 
<code>//</code> followed by a predicate and an object.
</p><div class="example"><div class="theorem"><span class="c014">Example 71</span>  <em>Shape with annotations</em><p><em>The following code declares a shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> which must have a </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> with a </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value, and a </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>birthDate</em></code><em> with a </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>date</em></code><em>. Each triple constraint has its corresponding </em><em>
</em><code><em>rdfs</em></code><code><em>:</em></code><code><em>label</em></code><em> and </em><em>
</em><code><em>rdfs</em></code><code><em>:</em></code><code><em>comment</em></code><em> annotations.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">      </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">  // </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">label</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Name"</span></em></span></span></em><em><span class="c012">
</span></em><em><span class="c012">  // </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">comment</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Name of person"</span></em></span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">birthDate</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">date</span></span></em><em><span class="c012">
</span></em><em><span class="c012">   // </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">label</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"birthDate"</span></em></span></span></em><em><span class="c012">
</span></em><em><span class="c012">   // </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">comment</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Birth of date"</span></em></span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>In this case, each triple constraint has its specific annotations which are internally represented as triples.</em></p></div></div><p>At the time of this writing ShEx does not have any built-in annotation vocabulary. 
It is expected that some specific annotations could be used for future uses like user interface generation or any other use case. </p>
<h2 class="section" id="sec100">4.8  Logical Operators</h2>
<p> 
<a id="ch040LogicalOperators"></a>
<a id="ch4.sec7"></a></p><p><a id="hevea_default418"></a>
<a id="hevea_default419"></a>
<a id="hevea_default420"></a>
The logical operators 
<code>AND</code>, 
<code>OR</code>, and 
<code>NOT</code> can be used to form complex shape expressions. 
Their meaning follows the conventional logical meaning of conjunction, disjunction, and negation.
The precedence of the operators is the usual one.</p><blockquote class="table"><div class="center"><hr class="c022"></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c019">Table 4.6: Logical operators on shape expressions</td></tr>
</table></div>
<a id="ch040.LogicalOperatorsShEx"></a> 
<div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c016"> <span class="c014">Operation</span></td><td class="c017"><span class="c014">Description
</span></td></tr>
<tr><td class="c016"> 
<code>AND</code></td><td class="c017">
<code>S1</code><code> </code><code>AND</code><code> </code><code>S2</code> is satisfied if and only if both are satisfied
</td></tr>
<tr><td class="c016"> 
<code>OR</code></td><td class="c017">
<code>S1</code><code> </code><code>OR</code><code> </code><code>S2</code> is satisfied if and only if 
<code>S1</code> or 
<code>S2</code> (or both) are satisfied
</td></tr>
<tr><td class="c016"> 
<code>NOT</code></td><td class="c017">
<code>NOT</code><code> </code><code>S</code> is satisfied if and only if 
<code>S</code> is not satisfied
</td></tr>
</table>
</div>
<div class="center"><hr class="c022"></div></blockquote>
<h3 class="subsection" id="sec101">4.8.1  Conjunction</h3>
<p>
<a id="ch4.sec7.1"></a>
<a id="hevea_default421"></a></p><p>The 
<code>AND</code> operator forms a new shape expression from two shape expressions 
with the meaning that a node conforms to 
<code>S1</code><code> </code><code>AND</code><code> </code><code>S2</code> if it conforms to both 
<code>S1</code> and 
<code>S2</code>.</p><div class="example"><div class="theorem"><span class="c014">Example 72</span>  <em>Conjunction example</em><p><em>The following example expresses that </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> nodes must satisfy two shape expressions at the same time.
Notice that the appearance of the repeated property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>owns</em></code><em> means that both expressions must be satisfied, i.e., that the value of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>owns</em></code><em> must be an </em><em>
</em><code><em>IRI</em></code><em> and must have shape </em><em>
</em><code><em>:</em></code><code><em>Product</em></code><em>, which must have a property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>productId</em></code><em> whose value is a </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> between 5 and 10 characters.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ; </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">owns</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> }</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">owns</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> }</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">productId</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">MINLENGTH</span></span></em><em><span class="c012"> 5 </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">MAXLENGTH</span></span></em><em><span class="c012"> 10</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;            </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:owns</span></em><em><span class="c012"> </span></em><em><span class="c012">:product1</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;             </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:owns</span></em><em><span class="c012"> </span></em><em><span class="c012">:product2,</span></em><em><span class="c012"> </span></em><em><span class="c012">:product3</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;            </span></em><span class="c012"><em><span class="c012">#\Fails{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:owns</span></em><em><span class="c012"> </span></em><em><span class="c012">_:x</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:product1</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Product1"</span></em></span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">:product2</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Product2"</span></em></span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">:product3</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Product3"</span></em></span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">:product4</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"P4"</span></em></span></em><em><span class="c012"> .       </span></em><span class="c012"><em><span class="c012">#\Fails{:Product} *) </span></em></span><em><span class="c012">
</span></em><em><span class="c012">_:x</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:productId</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"ProductX"</span></em></span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *) </span></em></span></td></tr>
</table></div></div><p>If the left-hand side of the conjunction is a node constraint, the 
<code>AND</code> keyword can be omitted. </p><div class="example"><div class="theorem"><span class="c014">Example 73</span>  <em>Omitting ANDs</em><p><em>In the following schema, 
</em><em>
</em><code><em>:</em></code><code><em>User1</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>User2</em></code><em>, and </em><em>
</em><code><em>:</em></code><code><em>Product1</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>Product2</em></code><em> are equivalent:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User1</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> }</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User2</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> }</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product1</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">productId</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">MINLENGTH</span></span></em><em><span class="c012"> 5 </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">MAXLENGTH</span></span></em><em><span class="c012"> 10 }</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product2</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">productId</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">MINLENGTH</span></span></em><em><span class="c012"> 5 </span></em><em><span class="c012"><span class="c007">MAXLENGTH</span></span></em><em><span class="c012"> 10 }</span></em></td></tr>
</table></div></div><p><a id="hevea_default422"></a>
</p>
<h5 class="paragraph" id="sec102">Reusing shape expressions</h5>
<p> 
<a id="ch040ReusingShapesShEx"></a></p><p>A common situation is to declare a set of constraints that we want to repeat. </p><div class="example"><div class="theorem"><span class="c014">Example 74</span>  <em>Reusing constraints</em><p><em>In the following example, 
we reuse </em><em>
</em><code><em>:</em></code><code><em>CompanyConstraints</em></code><em> in two places (for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> and for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>affiliation</em></code><em>).</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CompanyConstraints</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> /^</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">:\/\/</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">\/</span></em><em><span class="c012"><span class="c007">id</span></span></em><em><span class="c012">[0-9]+/ </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CompanyShape</span></span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">        </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CompanyConstraints</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">affiliation</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CompanyConstraints</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">CompanyShape</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">founder</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">        </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;     </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012">    </span></em><em><span class="c012">:id1</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:affiliation</span></em><em><span class="c012"> </span></em><em><span class="c012">:id2</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:id1</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:founder</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:id2</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:founder</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div><p>Another example of shape reuse is to extend a shape with more constraints emulating a kind of inheritance as in Object-Oriented languages.</p><div class="example"><div class="theorem"><span class="c014">Example 75</span>  <em>Extending shapes</em><em> 
</em><a id="ch040ExtendingShapesShEx"></a><p><em>The following example declares a top-level shape </em><em>
</em><code><em>:</em></code><code><em>Person</em></code><em> whose nodes must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> with value </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Person</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em>. 
The shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> extends </em><em>
</em><code><em>:</em></code><code><em>Person</em></code><em> adding a new constraint on the existing property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> and declaring the need of another property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>email</em></code><em>. 
Finally, the shape </em><em>
</em><code><em>:</em></code><code><em>Student</em></code><em> extends </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> adding a new property </em><em>
</em><code><em>:</em></code><code><em>course</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">                    [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> ] ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">          </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">  ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">          </span></em><em><span class="c012"><span class="c007">MaxLength</span></span></em><em><span class="c012"> 20 ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">email</span></span></em><em><span class="c012">         </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Student</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">course</span></span></em><em><span class="c012">              </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> *;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:Person</span></em><em><span class="c012"> ;      </span></em><span class="c012"><em><span class="c012"># \Passes{:Person} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">    </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012">;            </span></em><span class="c012"><em><span class="c012"># \Fails{:User} *)   </span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:email</span></em><em><span class="c012">   &lt;</span></em><em><span class="c012">bob@example</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">&gt; .  </span></em><span class="c012"><em><span class="c012"># lacks rdf:type :Person *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:Person</span></em><em><span class="c012">;       </span></em><span class="c012"><em><span class="c012"># \Passes{:Person and :User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:email</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">carol@example</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">&gt; .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012">  </span></em><em><span class="c012">a</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:Person</span></em><em><span class="c012">;      </span></em><span class="c012"><em><span class="c012"># \Passes{:Person, :User and Student} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:email</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">carol@example</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">&gt;;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">:course</span></em><em><span class="c012">      </span></em><em><span class="c012">:algebra</span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>Notice that this kind of reuse requires the shapes extended to be compatible with the new ones. 
Otherwise, there will be no nodes satisfying them. </em></p><p><em>For example, we may want to declare a </em><em>
</em><code><em>:</em></code><code><em>Teacher</em></code><em> shape extending </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> but adding the constraint that teachers have no email.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">email</span></span></em><em><span class="c012"> . {0,0} ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>However, there will be no nodes satisfying it, because shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> prescribes that they must have exactly one </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>email</em></code><em>, while the extended shape </em><em>
</em><code><em>:</em></code><code><em>Teacher</em></code><em> prescribes that they must have no </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>email</em></code><em>. </em></p><p><em>In order to obtain the desired model, it is necessary that the shapes to be extended are general enough to be compatible with the new shapes.
In this case, for example, it would be better to declare that the cardinality of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>email</em></code><em> in </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> was optional. </em></p></div></div>
<h3 class="subsection" id="sec103">4.8.2  Disjunction</h3>
<p>
<a id="ch4.sec7.2"></a></p><p><a id="hevea_default423"></a> <a id="hevea_default424"></a>
The 
<code>Or</code> operator combines two shape expressions with an inclusive disjunction, 
i.e., either one side or the other, or both must be satisfied.</p><div class="example"><div class="theorem"><span class="c014">Example 76</span>  <em>Disjunction</em><p><em>The following example declares that nodes of shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> must have either a </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> with </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value or 
a combination of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>givenName</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>familyName</em></code><em> with </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> values, or both.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> }</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">      }</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012">;         </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Smith"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"Carol King"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"King"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div><div class="example"><div class="theorem"><span class="c014">Example 77</span>  <em>Difference between </em><em>
</em><code><em>Or</em></code><em> and </em><em>
</em><code><em>|</em></code><p><em>There is a difference between the </em><em>
</em><code><em>Or</em></code><em> and the choice (</em><em>
</em><code><em>|</em></code><em>) operator. 
The former defines an inclusive-or, while the latter specifies an exclusive-or in this case (only one of the shape expressions must be satisfied, but not both).</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User1</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> }</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">         </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">       }</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User2</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">       | </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">         </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">       }</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012">#\Passes{:User1 and :User2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012">;         </span></em><span class="c012"><em><span class="c012">#\Passes{:User1 and :User2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Smith"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"Carol King"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Passes{:User1} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012">;        </span></em><span class="c012"><em><span class="c012">#\Fails{:User2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"King"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012"> ;        </span></em><span class="c012"><em><span class="c012">#\Passes{:User1} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012">#\Fails{:User2} *)</span></em></span></td></tr>
</table></div></div><div class="example"><div class="theorem"><span class="c014">Example 78</span>  <em>Disjunction of datatypes</em><p><em>A common use case is to declare that the value of some property is the disjunction of several datatypes or value sets. 
The following example declares that products must have a </em><em>
</em><code><em>rdfs</em></code><code><em>:</em></code><code><em>label</em></code><em> with a string value or a language tagged literal (remember that those literal have type </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>langString</em></code><em>), and a </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>releaseDate</em></code><em> whose values must be either </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>date</em></code><em>, </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>gYear</em></code><em> or one of the values </em><em>
</em><code><em>"</em></code><code><em>unknown</em></code><code><em>-</em></code><code><em>past</em></code><code><em>"</em></code><em> or </em><em>
</em><code><em>"</em></code><code><em>unknown</em></code><code><em>-</em></code><code><em>future</em></code><code><em>"</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">label</span></span></em><em><span class="c012">         </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">langString</span></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">releaseDate</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">date</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">gYear</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012">
</span></em><em><span class="c012">                    [ </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"unknown-past"</span></em></span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"unknown-future"</span></em></span></span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:p1</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:Product</span></em><em><span class="c012"> ;                           </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">rdfs:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Laptop"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:releaseDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"1990"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:gYear</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p2</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:Product</span></em><em><span class="c012"> ;                           </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">rdfs:label</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Car"</span></em></span></em><em><span class="c012">@en</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:releaseDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"unknown-future"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:p3</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:Product</span></em><em><span class="c012"> ;                           </span></em><span class="c012"><em><span class="c012">#\Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">rdfs:label</span></em><em><span class="c012"> </span></em><em><span class="c012">:House</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012">schema:releaseDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"2020"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:integer</span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div>
<h5 class="paragraph" id="sec104">Emulating recursive property paths</h5>
<p>SPARQL property paths are a very expressive feature that can define complex expressions. 
ShEx does not support property paths in order to have a more controlled way to define shapes. 
However, using nested shapes (see Example <a href="#ch040%3ANestedShapesPropertyPaths">58</a>), 
recursion and logical operators, it is possible to emulate their behavior.</p><div class="example"><div class="theorem"><span class="c014">Example 79</span>  <em>SHACL instance of Person</em><p><em>In SHACL, instances are declared by the expression </em><em>
</em><code><em>rdfs</em></code><code><em>:</em></code><code><em>subClassOf</em></code><code><em>*/</em></code><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em>, which defines the closure of the </em><em>
</em><code><em>rdfs</em></code><code><em>:</em></code><code><em>subClassof</em></code><em> property followed by </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> 
(see Section </em><a href="bookHtml011.html#ch050SHACLInstance"><em>5.7.2</em></a><em>). 
The following example declares that nodes conforming to shape </em><em>
</em><code><em>:</em></code><code><em>Person</em></code><em> must be SHACL instances of </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Person</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">PersonShape</span></span></em><em><span class="c012"> }</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">PersonShape</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> ] </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">subClassOf</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">PersonShape</span></span></em><em><span class="c012"> }</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012">     </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Person</span></em><em><span class="c012"> .               </span></em><span class="c012"><em><span class="c012">#\Passes{:Person} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">       </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:Teacher</span></em><em><span class="c012"> .                    </span></em><span class="c012"><em><span class="c012">#\Passes{:Person} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012">     </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">:Assistant</span></em><em><span class="c012"> .                  </span></em><span class="c012"><em><span class="c012">#\Passes{:Person} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:Teacher</span></em><em><span class="c012">   </span></em><em><span class="c012">rdfs:subClassOf</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Person</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">:Assistant</span></em><em><span class="c012"> </span></em><em><span class="c012">rdfs:subClassOf</span></em><em><span class="c012"> </span></em><em><span class="c012">:Teacher</span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div>
<h3 class="subsection" id="sec105">4.8.3  Negation</h3>
<p> 
<a id="ch040ShExNegation"></a>
<a id="ch4.sec7.3"></a>
<a id="hevea_default425"></a></p><p>
<code>NOT</code><code> </code><code>s</code> creates a new shape expression from a shape 
<code>s</code>. 
Nodes conform to 
<code>NOT</code><code> </code><code>s</code> when they do not conform to 
<code>s</code>. </p><div class="example"><div class="theorem"><span class="c014">Example 80</span>  <em>Not</em><em> </em><a id="ch040ShExNot"></a><em>
</em><em>
</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">NoName</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">Not</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Passes{:NoName} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:familyName</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Cooper"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> . </span></em><span class="c012"><em><span class="c012">#\Fails{:NoName} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:givenName</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> ;  </span></em><span class="c012"><em><span class="c012">#\Fails{:NoName} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div><p>A common use case for 
<code>Not</code> is to check other shapes. 
Defining a shape 
<code>:</code><code>NotS</code> as 
<code>Not</code><code> :</code><code>S</code>, 
all nodes in an RDF graph can be valid, some of them will conform to 
<code>:</code><code>S</code> while the others will conform to 
<code>:</code><code>NotS</code>.
In this way, a continuous integration system can define the shape map that all nodes must satisfy (either positive or negatively)
and check whether they satisfy it or not.</p><div class="example"><div class="theorem"><span class="c014">Example 81</span>  <em>Not</em><em> 
</em><a id="ch040ShExNotCheck"></a><p><em>The following code declares a shape </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> and its complementary </em><em>
</em><code><em>:</em></code><code><em>NotUser</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">      </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">birthDate</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">date</span></span></em><em><span class="c012">? ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">NoUser</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">Not</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em></td></tr>
</table><p><em>Both nodes </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> conform to one of the shapes, </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> to </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> to </em><em>
</em><code><em>:</em></code><code><em>NoUser</em></code><em>. </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">      </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012"> ;   </span></em><span class="c012"><em><span class="c012">#\Passes{:User} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"1980-03-10"</span></em></span></em><em><span class="c012">^^</span></em><em><span class="c012">xsd:date</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">       23 ;       </span></em><span class="c012"><em><span class="c012">#\Passes{:NoUser} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:birthDate</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Unknown"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div>
<h5 class="paragraph" id="sec106">Difference between Not and Max-cardinality 0</h5>
<p>
<a id="hevea_default426"></a>
The operator 
<code>Not</code> checks that a node fails to conform to a whole shape expression. 
Sometimes, the intended meaning is not to negate a whole shape expression but to declare that some properties cannot appear.
This behavior is better described by declaring the maximum cardinality to 0.</p><div class="example"><div class="theorem"><span class="c014">Example 82</span>  <em>Difference between Not and Max-0</em><em> 
</em><a id="ch040ShExNotMaxCard0"></a><p><em>Shape </em><em>
</em><code><em>:</em></code><code><em>NoName1</em></code><em> prohibits the appearance of property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> establishing its maximum cardinality to 0.
Shape </em><em>
</em><code><em>:</em></code><code><em>NoName2</em></code><em> looks like it does the same thing using the negation. 
However, notice that </em><em>
</em><code><em>:</em></code><code><em>NoName2</em></code><em> will be satisfied by any node that does not conform to </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><code><em> </em></code><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">NoName1</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">      </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> {0}</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">NoName2</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">Not</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">      </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>The behavior differs for node </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> which conforms to </em><em>
</em><code><em>:</em></code><code><em>NoName2</em></code><em>. The reason is that it fails to have a string value for </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> so it fails to conform to the shape </em><em>
</em><code><em>{</em></code><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><code><em> </em></code><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><code><em>}</em></code><em> and thus, conforms to </em><em>
</em><code><em>:</em></code><code><em>NoName2</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">. </span></em><span class="c012"><em><span class="c012">#\Fails{:NoName1 and :NoName2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> 23 .     </span></em><span class="c012"><em><span class="c012">#\Fails{:NoName1}*) \Passes{:NoName2} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">foaf:age</span></em><em><span class="c012"> 34 .        </span></em><span class="c012"><em><span class="c012">#\Passes{:NoName1}*) \Passes{:NoName2} *)</span></em></span></td></tr>
</table></div></div>
<h5 class="paragraph" id="sec107">IF-THEN pattern</h5>
<p>
<a id="hevea_default427"></a>
A common pattern is the IF-THEN construct:
if some condition holds, then a given shape expression must be satisfied. </p><p>This pattern can be modeled using the logical operators 
<code>OR</code> and 
<code>NOT</code>. 
Remember that 
<code>IF</code><code> </code><code>x</code><code> </code><code>THEN</code><code> </code><code>y</code> is equivalent to 
<code>(</code><code>NOT</code><code> </code><code>x</code><code>) </code><code>OR</code><code> </code><code>y</code>.</p><div class="example"><div class="theorem"><span class="c014">Example 83</span>  <em>IF-THEN pattern example</em><em> 
</em><a id="ch040ShExIFTHEN"></a><p><em>The following example specifies that all products must have a </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>productID</em></code><em> and 
if a product has type </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Vehicle</em></code><em>, 
then it must have the properties </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>vehicleEngine</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>fuelType</em></code><em>. </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">productID</span></span></em><em><span class="c012"> . } </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">NOT</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Vehicle</span></span></em><em><span class="c012"> ] }</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012"> { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">vehicleEngine</span></span></em><em><span class="c012"> . ;</span></em><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">fuelType</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012"> }</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:kitt</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:productID</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"C21"</span></em></span></em><em><span class="c012">;     </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Vehicle</span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:vehicleEngine</span></em><em><span class="c012"> </span></em><em><span class="c012">:x42</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:fuelType</span></em><em><span class="c012"> </span></em><em><span class="c012">:electric</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bad</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:productID</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"C22"</span></em></span></em><em><span class="c012">;     </span></em><span class="c012"><em><span class="c012">#\Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Vehicle</span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:fuelType</span></em><em><span class="c012"> </span></em><em><span class="c012">:electric</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:c23</span></em><em><span class="c012">  </span></em><em><span class="c012">schema:productID</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"C23"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Computer</span></em><em><span class="c012"> .</span></em></td></tr>
</table></div></div>
<h5 class="paragraph" id="sec108">IF-THEN-ELSE pattern</h5>
<p> 
<a id="ch040ShExIFTHENELSE"></a>
<a id="hevea_default428"></a>
The 
<code>IF</code><code>-</code><code>THEN</code><code>-</code><code>ELSE</code> pattern construct can be defined in a similar way. 
In this case: </p><p>IF X THEN Y ELSE Z≡((NOT X) OR Y) AND (X OR Z)</p><div class="example"><div class="theorem"><span class="c014">Example 84</span>  <em>IF-THEN-ELSE pattern example</em><em> </em><p><em>The following shape declares that if a product has type </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Vehicle</em></code><em>, 
then it must have the properties </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>vehicleEngine</em></code><em> and </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>fuelType</em></code><em>, otherwise, 
it must have the property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>category</em></code><em> with a </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Product</span></span></em><em><span class="c012"> (</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">NOT</span></span></em><em><span class="c012">  { </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [ </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Vehicle</span></span></em><em><span class="c012"> ] } </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012">
</span></em><em><span class="c012">       { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">vehicleEngine</span></span></em><em><span class="c012"> . ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">fuelType</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">       }</span></em><em><span class="c012">
</span></em><em><span class="c012"> ) </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> ({ </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [</span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Vehicle</span></span></em><em><span class="c012">] } </span></em><em><span class="c012"><span class="c007">OR</span></span></em><em><span class="c012">
</span></em><em><span class="c012">        { </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">category</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> } )</span></em></td></tr>
</table><p><em>With the following data, nodes </em><em>
</em><code><em>:</em></code><code><em>kitt</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>c23</em></code><em> conform to </em><em>
</em><code><em>:</em></code><code><em>Product</em></code><em> each one passing one of the branches, while </em><em>
</em><code><em>:</em></code><code><em>bad1</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>bad2</em></code><em> do not conform.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:kitt</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Vehicle</span></em><em><span class="c012">;           </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:vehicleEngine</span></em><em><span class="c012"> </span></em><em><span class="c012">:x42</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:fuelType</span></em><em><span class="c012"> </span></em><em><span class="c012">:electric</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:c23</span></em><em><span class="c012">  </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Computer</span></em><em><span class="c012"> ;         </span></em><span class="c012"><em><span class="c012">#\Passes{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:category</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Laptop"</span></em></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bad1</span></em><em><span class="c012">  </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Vehicle</span></em><em><span class="c012">;          </span></em><span class="c012"><em><span class="c012">#\Fails{:Product} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">schema:fuelType</span></em><em><span class="c012"> </span></em><em><span class="c012">:electric</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bad2</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:Computer</span></em><em><span class="c012"> .         </span></em><span class="c012"><em><span class="c012">#\Fails{:Product} *)</span></em></span></td></tr>
</table></div></div>
<h5 class="paragraph" id="sec109">Restriction on cyclic dependencies with negation</h5>
<p> 
<a id="ch040ShExCyclicDependencies"></a></p><p>One problem of combining recursion with negation freely is the possibility of defining paradoxical shapes.</p><div class="example"><div class="theorem"><span class="c014">Example 85</span>  <em>Barber’s paradox</em><p><em>The following shape declares a </em><em>
</em><code><em>:</em></code><code><em>Barber</em></code><em> as someone who shaves a person but does not shave a barber. </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Barber</span></span></em><em><span class="c012"> {               # </span></em><em><span class="c012"><span class="c007">Violates</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">the</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">negation</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">requirement</span></span></em><em><span class="c012">
</span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">shaves</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012">
</span></em><em><span class="c012">} </span></em><em><span class="c012"><span class="c007">AND</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">NOT</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">shaves</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Barber</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>Given the following data:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:albert</span></em><em><span class="c012"> </span></em><em><span class="c012">:shaves</span></em><em><span class="c012"> </span></em><em><span class="c012">:dave</span></em><em><span class="c012"> .        </span></em><span class="c012"><em><span class="c012">#\Passes{:Barber} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;    </span></em><span class="c012"><em><span class="c012">#\Passes{:Person} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">:shaves</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .            </span></em><span class="c012"><em><span class="c012"># Passes :Barber or not? *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:dave</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Dave"</span></em></span></em><em><span class="c012"> .     </span></em><span class="c012"><em><span class="c012">#\Passes{:Person} *)</span></em></span></td></tr>
</table><p><em>It is easy to check that </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> conforms to </em><em>
</em><code><em>:</em></code><code><em>Person</em></code><em> (he has </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> with a </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value), so he shaves a person, but:</em></p><p><em>Does </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> conform to </em><em>
</em><code><em>:</em></code><code><em>Barber</em></code><em>?</em></p><p><em>If we assume he does, then it should not shave another barber, but as he shaves himself, and we assumed he conformed to </em><em>
</em><code><em>:</em></code><code><em>Barber</em></code><em> then he fails the constraint of not shaving barbers which means that he should not conform. 
On the other hand, if we assumed he does not conform to </em><em>
</em><code><em>:</em></code><code><em>Barber</em></code><em> then he satisfies both constraints, and he should conform to </em><em>
</em><code><em>:</em></code><code><em>Barber</em></code><em>.</em></p></div></div><p>This kind of problems that arise when combining negation and recursion have been studied by the logic programming and databases community.
Several approaches have been studied such as negation-as-failure, stratified negation and well-founded semantics [<a href="bookHtml018.html#Abiteboul1995">1</a>]. </p><p>ShEx imposes a constraint to avoid ill formed data models: whenever a shape refers to itself either directly or indirectly, the chain of references cannot traverse an occurrence of the negation operation 
<code>NOT</code>. </p><p>The previous shape 
<code>:</code><code>Barber</code> violates the negation requirement as is has one self reference pointing to itself that includes a negation. 
More formally, we say that there is a dependency from 
<code>:</code><code>ShapeA</code> to 
<code>:</code><code>ShapeB</code> if the definition of 
<code>:</code><code>ShapeA</code> contains a reference 
<code>@</code><code>:</code><code>ShapeB</code>.</p><p><a id="hevea_default429"></a>
We say that a dependency from 
<code>:</code><code>ShapeA</code> to 
<code>:</code><code>ShapeB</code> is a negative dependency if at least one of the following holds:</p><ul class="itemize"><li class="li-itemize">
the occurrence of 
<code>@</code><code>:</code><code>ShapeB</code> in the definition of 
<code>:</code><code>ShapeA</code> appears under an occurrence of the negation operator 
<code>NOT</code>; and </li><li class="li-itemize">there is a triple constraint 
<code>:</code><code>prop</code><code> </code><code>@</code><code>:</code><code>ShapeB</code> in the definition of 
<code>:</code><code>ShapeA</code> and the property 
<code>:</code><code>prop</code> is declared as 

<code>EXTRA</code> in the corresponding triple expression.</li></ul><p>In the latter case, the negation operator 
<code>NOT</code> does not appear explicitly, 
but we still need to verify that a 
<code>:</code><code>ShapeB</code> is not satisfied in some neighbor nodes.
<a id="hevea_default430"></a>
This was called hidden negation in Section <a href="#ch040ShExExtra">4.6.8</a>.</p><p><a id="hevea_default431"></a>
</p>
<h2 class="section" id="sec110">4.9  Shape Maps</h2>
<p> 
<a id="ch040ShapeMaps"></a>
<a id="ch4.sec8"></a></p><p>The ShEx 2 specification is focused on the semantics of the validation language and separates the invocation mechanisms to a different specification called Shape Maps [<a href="bookHtml018.html#ShapeMap">77</a>].
They were already introduced in Section <a href="#ch040ValidationProcess">4.4.2</a> and are node/shape associations that are used as input to the validation process and are also the result of it. </p><p>In ShEx, the construction of shape maps is orthogonal to their use in validation.
Decoupling these processes enables ShEx to address a wide range of use cases.
<a id="hevea_default432"></a> <a id="hevea_default433"></a>
Just as XML Schema could not have predicted its use in WSDL (a protocol that was developed years later), it is impossible to predict the many and varied ways 
in which shape maps may be constructed in the future.</p><p>The current ShapeMap specification defines three kinds of shape map. </p><ul class="itemize"><li class="li-itemize"><em>Fixed shape map</em>: input to the validation process.
</li><li class="li-itemize"><em>Query shape map</em>: query mechanism to construct a fixed shape map.
</li><li class="li-itemize"><em>Result shape map</em>: result of validation.
</li></ul><p>Each of these consists of a comma-separated list of node/shape associations with at least two components. </p><ul class="itemize"><li class="li-itemize">

<code>nodeSelector</code> - identify a set of RDF nodes.
</li><li class="li-itemize">
<code>shapeLabel</code> - select a shape expression from the schema.
</li></ul><p>The simplest kind of shape map is a fixed shape map.</p><p><a id="hevea_default434"></a>
</p>
<h3 class="subsection" id="sec111">4.9.1  Fixed Shape Maps</h3>
<p> 
<a id="ch040fixedShapeMaps"></a>
<a id="ch4.sec8.1"></a></p><p>ShEx validation takes as input a set of nodeSelector/shapeLabel pairs called a <em>fixed shape map</em>.</p><p><a id="hevea_default435"></a> <a id="hevea_default436"></a> 
The 
<code>shapeLabel</code> is either the label for a shape expression in the schema or the case-insensitive keyword 
<code>START</code> to identify the start shape 
(see Section <a href="#ch040startExpr">4.4.4</a>).</p><p>For the fixed shape map, the 
<code>nodeSelector</code> is one of:</p><ul class="itemize"><li class="li-itemize">an RDF IRI,
</li><li class="li-itemize">an RDF literal, or 
</li><li class="li-itemize">for systems which support it, the label of a bnode in an RDF dataset.
</li></ul><p>Note that because the shapeLabel can identify a shape expression with only node constraints, one can use ShEx to valdiate RDF terms that do not appear in the graph.
This can be useful for testing membership in a value set or verifying the form of a URL.</p><p>Fixed shape maps have a compact syntax which consists of separating each shape association by comma and node selectors from shape labels by 
<code>@</code>:</p><table class="lstframe c015"><tr><td class="lstlisting"><span class="c012">:</span><span class="c012">alice@</span><span class="c012">:</span><span class="c012">User</span><span class="c012">,</span><span class="c012">
</span><span class="c012">:</span><span class="c012">alice@</span><span class="c012">:</span><span class="c012">Employee</span><span class="c012">,</span><span class="c012">
</span><span class="c012">:</span><span class="c012">bob@</span><span class="c012">:</span><span class="c012">User</span></td></tr>
</table><p><a id="hevea_default437"></a>
</p>
<h3 class="subsection" id="sec112">4.9.2  Query Shape Maps</h3>
<p> 
<a id="ch040queryShapeMaps"></a>
<a id="ch4.sec8.2"></a></p><p>The query shape map extends the fixed shape map to enable simple pattern matching to select focus nodes from the data graph.
This is done by permitting the node selectors to be either an RDF node as in a fixed map or a triple pattern.
<a id="hevea_default438"></a> <a id="hevea_default439"></a> <a id="hevea_default440"></a>
A triple pattern can have a focus keyword to represent the nodes that will be validated and a node or wildcard (represented by the underscore character 
<code>_</code>). </p><div class="example"><div class="theorem"><span class="c014">Example 86</span>  <em>Query shape map example</em><p><em>The shape map:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">{ </span></em><em><span class="c012"><span class="c007">FOCUS</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">_</span></span></em><em><span class="c012">            }</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">{ </span></em><em><span class="c012"><span class="c007">FOCUS</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdf</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">type</span></span></em><em><span class="c012">        </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012">}</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">,</span></em><em><span class="c012">
</span></em><em><span class="c012">{ </span></em><em><span class="c012"><span class="c007">_</span></span></em><em><span class="c012">     </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">FOCUS</span></span></em><em><span class="c012">        }</span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em></td></tr>
</table><p><em>associates all subjects of property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> and all nodes of type </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Person</em></code><em> with </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em>, 
and all objects of property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> with shape </em><em>
</em><code><em>:</em></code><code><em>Company</em></code><em>.</em></p><p><em>Any node in the data graph which is both of type </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>Person</em></code><em> and the subject of a </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>worksFor</em></code><em> triple would be selected by both triple patterns and associated with </em><em>
</em><code><em>:</em></code><code><em>User</em></code><em> in the fixed map.
Such duplicates are eliminated in accordance with the rule that a shape map can have no duplicate pairs of node selector and shape label.</em></p><blockquote class="figure"><div class="center"><hr class="c022"></div><em> 
</em><div class="center"><em>
<img src="ShEx_QueryShapeMap.png">
</em></div><em>

</em><a id="ch040.ShExValidatorQueryShapeMap"></a><em>
</em><div class="caption"><table class="c002 cellpading0"><tr><td class="c019"><em>Figure 4.10: Shape map resolution which accepts a query shape map and emits 
a fixed shape map.</em></td></tr>
</table></div><em>
</em><div class="center"><hr class="c022"></div></blockquote></div></div><p>While the node selector may be a triple pattern, it may also be an RDF node as we would see in a fixed shape map.
Common idioms of query map can do the following. </p><ul class="itemize"><li class="li-itemize">
Explicitly bind nodes to shapes. 
This effectively adds one nodeSelector/shapeLabel pair to the shape map.
<a id="hevea_default441"></a>
This mechanism is employed in SHACL with the declaration 
<code>sh</code><code>:</code><code>targetNode</code> 
(see Section <a href="bookHtml011.html#ch050TargetNodes">5.7</a>). </li><li class="li-itemize">Declare that all nodes with some property must match a given shape.
<a id="hevea_default442"></a>
<a id="hevea_default443"></a>
This mechanism is also defined in SHACL with the declarations 
<code>sh</code><code>:</code><code>targetSubjectsOf</code> and 
<code>sh</code><code>:</code><code>targetObjectsOf</code>. </li><li class="li-itemize">Select nodes with a given property and value.
<a id="hevea_default444"></a>
This refinement of the previous approach is especially useful for general-purpose predicates like 
<code>rdf</code><code>:</code><code>type</code>.
<a id="hevea_default445"></a>
In fact, the SHACL directive 
<code>sh</code><code>:</code><code>targetClass</code> offers a similar selection mechanism for the 
<code>rdf</code><code>:</code><code>type</code> predicate (the difference is that SHACL uses the notion of <em>SHACL instance</em>), see <a href="bookHtml011.html#ch050SHACLInstance">5.7.2</a>).
As with the above selectors, this one is very use-case 
specific—one may not want to say that everything with an 
<code>rdf</code><code>:</code><code>type</code> property should be validated against a 
<code>:</code><code>Person</code>, 
but it may be reasonable to select everything with type 
<code>:</code><code>Employee</code>.</li></ul><p><a id="hevea_default446"></a> <a id="hevea_default447"></a>
While it is not currently part of the shape map specification, the Wikidata use of shape maps extends the nodeSelector to contain a SPARQL query, enabling another common use case. </p><ul class="itemize"><li class="li-itemize">
Select nodes or node/shape pairs by SPARQL query or inference. 
Where earlier mechanisms are all limited to either a direct identification of an RDF node or its selection by triple pattern, 
this one enables a more nuanced heuristics in the selection of focus nodes.</li></ul><p>Query shape maps are not the only way to select focus nodes.
<a id="hevea_default448"></a>
For instance, it would make sense to associate a shape with a service endpoint.
<a id="hevea_default449"></a>
<a id="hevea_default450"></a>
The Linked Data Platform [<a href="bookHtml018.html#linkedDataPlatform">93</a>] defines a notion of container which handles 
requests to get, create, modify and delete objects with a given structure.
While it does not specify a mechanism to publish that structure or validate incoming data against it, 
<a id="hevea_default451"></a>
earlier work at OSLC used Resource Shapes for that purpose.
It is reasonable to assume that protocols like the linked data platform will exploit shapes technology, 
<a id="hevea_default452"></a>
perhaps with the added precision of using HTTP Link headers to specify a node of interest, 
which would be associated with the related shape with that interface.</p>
<h3 class="subsection" id="sec113">4.9.3  Result Shape Maps</h3>
<p> 
<a id="ch040resultShapeMaps"></a>
<a id="ch4.sec8.3"></a></p><p>The product of validation is a result shape map which is annotated with errors encountered while testing the conformance of each node/shape pair.
The result shape map is again an extension of the fixed map.
Each nodeSelector/shapeLabel association in the result shape map may include any of these three additional components:</p><ul class="itemize"><li class="li-itemize">

<code>result</code>: either 
<code>conformant</code> or 
<code>nonconformant</code>;
</li><li class="li-itemize">
<code>reason</code>: a human-readable report, usualy to explain a non-conformant 
result; or 
</li><li class="li-itemize">
<code>appInfo</code>: a machine readable structure.
</li></ul><p>Engines vary in how they report errors, and they may add extra information to the resulting shape map.
Some implementations extend this to include machine-readable failure messages in case of errors or recursive <em>proof</em>
of conformance in case of success.</p><div class="example"><div class="theorem"><span class="c014">Example 87</span>  <em>Full validation process</em><p><em>Given the following ShEx schema:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>and the RDF data:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> </span></em><em><span class="c012">:carol</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> </span></em><em><span class="c012">:carol</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Carol"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>If we have the query shape map:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">{</span></em><em><span class="c012">FOCUS</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> </span></em><em><span class="c012">_</span></em><em><span class="c012"> }</span></em><em><span class="c012">@:User</span></em></td></tr>
</table><p><em>A shape map resolver would generate the fixed shape map:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice@:User,</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob@:User</span></em></td></tr>
</table><p><em>After applying the validation process, the result shape map obtained would be:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice@:User,</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob@:User,</span></em><em><span class="c012">
</span></em><em><span class="c012">:carol@:User</span></em></td></tr>
</table><p><em>Figure </em><a href="#ch040.ShExValidatorProcessFull"><em>87</em></a><em> depicts a whole validation process with the different shape maps involved.</em></p><blockquote class="figure"><div class="center"><hr class="c022"></div><em> 
</em><div class="center"><em>
<img src="ShEx_ValidationFull.png">
</em></div><em>

</em><a id="ch040.ShExValidatorProcessFull"></a><em>
</em><div class="caption"><table class="c002 cellpading0"><tr><td class="c019"><em>Figure 4.11: Full validation process with query, fixed, and result shape map.</em></td></tr>
</table></div><em>
</em><div class="center"><hr class="c022"></div></blockquote></div></div>
<h3 class="subsection" id="sec114">4.9.4  JSON Representation</h3>
<p> 
<a id="ch040jsonShapeMaps"></a>
<a id="ch4.sec8.4"></a></p><p>The fixed shape map from Figure <a href="#ch040.ShExValidatorProcessFull">87</a> can be represented as:<sup><a id="text9" href="#note9">2</a></sup> </p><div class="example"><div class="theorem"><span class="c014">Example 88</span>  <em>JSON representation of shape maps</em><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">[ { "</span></em><em><span class="c012">node</span></em><em><span class="c012">": ":</span></em><em><span class="c012">alice</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">shape</span></em><em><span class="c012">": ":</span></em><em><span class="c012">User</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">  },</span></em><em><span class="c012">
</span></em><em><span class="c012">  { "</span></em><em><span class="c012">node</span></em><em><span class="c012">": ":</span></em><em><span class="c012">bob</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">shape</span></em><em><span class="c012">": ":</span></em><em><span class="c012">User</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">  }</span></em><em><span class="c012">
</span></em><em><span class="c012">]</span></em></td></tr>
</table><p><em>The output shape map would be:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">[ { "</span></em><em><span class="c012">node</span></em><em><span class="c012">": ":</span></em><em><span class="c012">alice</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">shape</span></em><em><span class="c012">": ":</span></em><em><span class="c012">User</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">status</span></em><em><span class="c012">": "</span></em><em><span class="c012">conformant</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">  },</span></em><em><span class="c012">
</span></em><em><span class="c012">  { "</span></em><em><span class="c012">node</span></em><em><span class="c012">": ":</span></em><em><span class="c012">bob</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">shape</span></em><em><span class="c012">": ":</span></em><em><span class="c012">User</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">status</span></em><em><span class="c012">": "</span></em><em><span class="c012">conformant</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">  },</span></em><em><span class="c012">
</span></em><em><span class="c012">  { "</span></em><em><span class="c012">node</span></em><em><span class="c012">": ":</span></em><em><span class="c012">carol</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">shape</span></em><em><span class="c012">": ":</span></em><em><span class="c012">User</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">    "</span></em><em><span class="c012">status</span></em><em><span class="c012">": "</span></em><em><span class="c012">conformant</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">  }</span></em><em><span class="c012">
</span></em><em><span class="c012">]</span></em></td></tr>
</table></div></div>
<h3 class="subsection" id="sec115">4.9.5  Chaining Validation Workflows</h3>
<p> 
<a id="ch040LongRunning"></a>
<a id="ch4.sec8.5"></a></p><p>Because the input and output of the validation process is a shape map, 
long-running workflows can use the result shape map as a starting state for further validation.
This is useful when shapes have inter-dependencies, i.e., when validating one node/shape pair requires validating others.
Let’s look at a simplified subset of that schema and data. </p><div class="example"><div class="theorem"><span class="c014">Example 89</span>  <em>ShEx validator and shape maps</em><p><em>Given the following schema:</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>and RDF graph</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012">   </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">  </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>If we were to individually validate </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em>, we would validate </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> twice, once while validating </em><em>
</em><code><em>:</em></code><code><em>alice</em></code><em>’s </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>knows</em></code><em> arc and once for the explicit call to validate </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em>.</em></p></div></div><p><a id="hevea_default453"></a>
</p>
<h2 class="section" id="sec116">4.10  Semantic Actions</h2>
<p> 
<a id="ch040SemanticActions"></a>
<a id="ch4.sec9"></a></p><p>Semantic actions<sup><a id="text10" href="#note10">3</a></sup> 
serve as an extension point for Shape Expressions.
They can be used to signal a failure or perform some operations during the validation process.</p><p>A semantic action contains a label that indicates the language in which the action is written and a string with its contents.
When the ShEx validator finds a semantic action, it checks if it has a processor for that language and calls it with the action contents. 
The result of the processor is cast to a Boolean value, in case the result is 
<code>false</code>, the corresponding shape would fail.</p><div class="example"><div class="theorem"><span class="c014">Example 90</span>  <em>Semantic actions</em><p><em>The following example uses a hypothetical Javascript semantic actions processor to capture the start and end events in a conference and to check that the start date is before the end date. </em></p><pre class="verbatim"><em>prefix js: &lt;http://shex.io/extensions/javascript&gt;

:Event {
 schema:startDate xsd:dateTime  %js:{ let start = o %} ;
 schema:endDate   xsd:dateTime  %js:{ let end = o %} ;
}
</em></pre><p><em>The following example checks that the declared area of a rectangle is effectively its width times height. </em></p><pre class="verbatim"><em>prefix js: &lt;http://shex.io/extensions/javascript&gt;

:Rectangle {
 :height xsd:float  %js:{ let height = o %} ;
 :width  xsd:float  %js:{ let width = o %} ;
 :area xsd:float    %js:{ o = height * width  %} 
}
</em></pre></div></div><p>Semantic actions have been employed to transform RDF files to other formats like XML or JSON [<a href="bookHtml018.html#EricSemantics2014">80</a>], or even other ShEx schemas as performed by the Map extension.<sup><a id="text11" href="#note11">4</a></sup></p><p>The test suite defines a single extension language called Test<sup><a id="text12" href="#note12">5</a></sup> 
that can fail a validation and/or return a message.
</p>
<h2 class="section" id="sec117">4.11  ShEx and Inference</h2>
<p> 
<a id="ch040ShExInference"></a>
<a id="ch4.sec10"></a></p><p><a id="hevea_default454"></a></p><p>ShEx was designed as an RDF validation language which is independent of reasoners or inference systems. 
A ShEx processor takes as input an RDF graph and checks if its nodes conform to the shapes defined in a ShEx schema. 
The shapes describe the topology of the RDF graph taking into account the possible values of nodes as well as the incoming and outgoing arcs.
In ShEx, a triple whose predicate is 
<code>rdf</code><code>:</code><code>type</code> is treated as any other triple, and in fact there is no special treatment for nodes that are also RDF classes. 
ShEx separates RDF classes and types following the guidelines described 
in Section <a href="bookHtml009.html#ch030ShapesNotTypes">3.2</a>.</p><p>This independence between ShEx and reasoners makes it possible to apply a ShEx processor to a plain RDF graph before inference, 
to validate the resulting graph after applying a reasoner, or even to validate the intermediate graphs during the reasoning phase, 
checking reasoner’s behavior.</p><div class="example"><div class="theorem"><span class="c014">Example 91</span>  <em>Validating data before and after inference</em><em>
</em><a id="hevea_default455"></a><em>
</em><a id="hevea_default456"></a><p><em>The following shapes can be used to check an RDF graph before and after RDF Schema inference. 
Shape </em><em>
</em><code><em>:</em></code><code><em>TeacherBefore</em></code><em> describes that nodes must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> </em><em>
</em><code><em>:</em></code><code><em>Teacher</em></code><em>, 
a property </em><em>
</em><code><em>schema</em></code><code><em>:</em></code><code><em>name</em></code><em> with a </em><em>
</em><code><em>xsd</em></code><code><em>:</em></code><code><em>string</em></code><em> value and zero or more properties </em><em>
</em><code><em>:</em></code><code><em>teaches</em></code><em> whose nodes must conform to </em><em>
</em><code><em>:</em></code><code><em>Course</em></code><em>.</em></p><p><em>Shape </em><em>
</em><code><em>:</em></code><code><em>TeacherAfter</em></code><em> describes the shape that teachers must have after inference. 
For example, they must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> </em><em>
</em><code><em>:</em></code><code><em>Teacher</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>Person</em></code><em>, 
and the values of property </em><em>
</em><code><em>:</em></code><code><em>teaches</em></code><em> must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> </em><em>
</em><code><em>:</em></code><code><em>Course</em></code><em>.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">TeacherBefore</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">EXTRA</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">           [:</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012">]? ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">teaches</span></span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">TeacherAfter</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">EXTRA</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">           [:</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012">];</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">           [:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012">];</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">teaches</span></span></em><em><span class="c012">    { </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012">] } </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012"> [:</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012">]?</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>If we validate the following RDF data before applying inference,
nodes </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>carol</em></code><em> do not conform to shape </em><em>
</em><code><em>:</em></code><code><em>TeacherAfter</em></code><em> </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">alice</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">           :</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012">, :</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012">; #\</span></em><em><span class="c012"><span class="c007">Passes</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">TeacherBefore</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Alice"</span></em></span></span></em><em><span class="c012"> ;          #\</span></em><em><span class="c012"><span class="c007">Passes</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">TeacherAfter</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">       :</span></em><em><span class="c012"><span class="c007">teaches</span></span></em><em><span class="c012">    :</span></em><em><span class="c012"><span class="c007">algebra</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">bob</span></span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Robert"</span></em></span></span></em><em><span class="c012"> ;         #\</span></em><em><span class="c012"><span class="c007">Passes</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">TeacherBefore</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">       :</span></em><em><span class="c012"><span class="c007">teaches</span></span></em><em><span class="c012">    :</span></em><em><span class="c012"><span class="c007">logic</span></span></em><em><span class="c012"> .           #\</span></em><em><span class="c012"><span class="c007">Fails</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">TeacherAfter</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">carol</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">           :</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012"> ;         #\</span></em><em><span class="c012"><span class="c007">Passes</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">TeacherBefore</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c005"><em><span class="c012">"Carol"</span></em></span></span></em><em><span class="c012"> .          #\</span></em><em><span class="c012"><span class="c007">Fails</span></span></em><em><span class="c012">{:</span></em><em><span class="c012"><span class="c007">TeacherAfter</span></span></em><em><span class="c012">} *)</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">algebra</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">a</span></span></em><em><span class="c012">               :</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">teaches</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">domain</span></span></em><em><span class="c012">     :</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">teaches</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">range</span></span></em><em><span class="c012">      :</span></em><em><span class="c012"><span class="c007">Course</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Teacher</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">rdfs</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">subClassOf</span></span></em><em><span class="c012"> :</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> .</span></em></td></tr>
</table><p><em>On the other side, if we validate the previous RDF graph after applying RDF Schema inference, both </em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> and </em><em>
</em><code><em>:</em></code><code><em>carol</em></code><em> should conform to </em><em>
</em><code><em>:</em></code><code><em>TeacherAfter</em></code><em>. </em></p><p><em>This combination of shapes before and after inference can be used to check the behavior of a reasoner. 
For example, if in the previous case, a faulty RDFS reasoner does not infer that </em><em>
</em><code><em>:</em></code><code><em>logic</em></code><em> must have </em><em>
</em><code><em>rdf</em></code><code><em>:</em></code><code><em>type</em></code><em> </em><em>
</em><code><em>:</em></code><code><em>Course</em></code><em>, 
</em><em>
</em><code><em>:</em></code><code><em>bob</em></code><em> would not conform to </em><em>
</em><code><em>:</em></code><code><em>TeacherAfter</em></code><em> and the bug could be detected.</em></p></div></div>
<h2 class="section" id="sec118">4.12  Importing schemas</h2>
<p> 
<a id="ch040ImportMechanism"></a></p><p><a id="hevea_default457"></a>
ShEx has an 
<code>import</code> keyword that specifies the IRI of another schema that can be imported.
The ShEx processor puts the labeled shapes and triple expressions of the imported schema in scope 
for resolution of references in the importing document.
If the imported schema imports other schemas, they are also imported.</p><div class="example"><div class="theorem"><span class="c014">Example 92</span>  <em>Import example</em><p><em>For example, if there is a schema located at </em><em>
</em><code><em>http</em></code><code><em>://</em></code><code><em>example</em></code><code><em>.</em></code><code><em>org</em></code><code><em>/</em></code><code><em>Person</em></code><code><em>.</em></code><code><em>shex</em></code><em> with the content.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">$</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> ( </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">          | </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">givenName</span></span></em><em><span class="c012"> . ; </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">familyName</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">          ) ;</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">email</span></span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>And we define a new schema as.</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c007">import</span></span></em><em><span class="c012"> &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">shex</span></span></em><em><span class="c012">&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Employee</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">    &amp;:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">worksFor</span></span></em><em><span class="c012"> &lt;</span></em><em><span class="c012"><span class="c007">CompanyShape</span></span></em><em><span class="c012">&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Company</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">employee</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Employee</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">    </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">founder</span></span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">Person</span></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">:alice</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012">     </span></em><em><span class="c012"><em><span class="c012">"Alice"</span></em></span></em><em><span class="c012">;      </span></em><span class="c012"><em><span class="c012">#\Passes{:Employee} *)</span></em></span><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">schema:worksFor</span></em><em><span class="c012"> </span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:OurCompany</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:employee</span></em><em><span class="c012"> </span></em><em><span class="c012">:alice</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">            </span></em><em><span class="c012">schema:founder</span></em><em><span class="c012">  </span></em><em><span class="c012">:bob</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:bob</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> </span></em><em><span class="c012"><em><span class="c012">"Robert"</span></em></span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">schema:email</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">mailto:bob@example</span></em><em><span class="c012">.</span></em><em><span class="c012">com</span></em><em><span class="c012">&gt; .</span></em></td></tr>
</table></div></div><p>The ShEx processor imports each imported schemas exactly once so cyclic imports are allowed.
For instance, a schema may import itself or it may import some schema which directly or indirectly imports it.</p><p>However, it is an error to import a schema which attempts to re-define a shape expression or triple expression.
For instance, if 
<code>http</code><code>://</code><code>example</code><code>.</code><code>org</code><code>/</code><code>Person</code><code>.</code><code>shex</code> defined either 
<code>:</code><code>Employee</code> or 
<code>:</code><code>Company</code>, 
or if the importing schema defined 
<code>:</code><code>name</code>, the import would fail and processing would stop.</p>
<h2 class="section" id="sec119">4.13  RDF and JSON-LD Syntax</h2>
<p> 
<a id="ch040OtherShExSyntaxes"></a>
<a id="ch4.sec11"></a></p><p><a id="hevea_default458"></a> <a id="hevea_default459"></a>
The ShEx language is defined in terms of a JSON-LD syntax, called “ShExJ”, which separates the compact syntax details from the language specification.
This serves as an abstract syntax in that it has constructs to capture all of the logic of ShEx.
Having an abstract syntax provides a clear definition of the language, 
makes it easier to write language processors and encourages the definition of other concrete syntax formats.
<a id="hevea_default460"></a> <a id="hevea_default461"></a> <a id="hevea_default462"></a>
The fact that it is JSON-LD means that the RDF representation of ShEx, 
called “ShExR”, is simply the JSON-LD interpretation of ShExJ.</p><div class="example"><div class="theorem"><span class="c014">Example 93</span>  <em> 
</em><a id="ch040.ExampleShExR"></a><p><em>The following ShEx schema</em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012"><span class="c007">PREFIX</span></span></em><em><span class="c012"> :       &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">example</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c007">PREFIX</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">: &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c007">PREFIX</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:  &lt;</span></em><em><span class="c012"><span class="c007">http</span></span></em><em><span class="c012">://</span></em><em><span class="c012"><span class="c007">www</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">w3</span></span></em><em><span class="c012">.</span></em><em><span class="c012"><span class="c007">org</span></span></em><em><span class="c012">/2001/</span></em><em><span class="c012"><span class="c007">XMLSchema</span></span></em><em><span class="c012">#&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c007">IRI</span></span></em><em><span class="c012"> {</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">name</span></span></em><em><span class="c012">          </span></em><em><span class="c012"><span class="c007">xsd</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">string</span></span></em><em><span class="c012">  ;</span></em><em><span class="c012">
</span></em><em><span class="c012">  </span></em><em><span class="c012"><span class="c007">schema</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">knows</span></span></em><em><span class="c012">         </span></em><em><span class="c012"><span class="c007">@</span></span></em><em><span class="c012">:</span></em><em><span class="c012"><span class="c007">User</span></span></em><em><span class="c012">*</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table><p><em>can be represented in ShExR as</em><sup><a id="text13" href="#note13"><em>6</em></a></sup><em>: </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">PREFIX</span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c014">sx:</span></span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">shex</span></em><em><span class="c012">.</span></em><em><span class="c012">io</span></em><em><span class="c012">/</span></em><em><span class="c012">ns</span></em><em><span class="c012">/</span></em><em><span class="c012">shex</span></em><span class="c012"><em><span class="c012">#&gt;</span></em></span><em><span class="c012">
</span></em><em><span class="c012">PREFIX</span></em><em><span class="c012"> </span></em><em><span class="c012">xsd:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">www</span></em><em><span class="c012">.</span></em><em><span class="c012">w3</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/2001/</span></em><em><span class="c012">XMLSchema</span></em><span class="c012"><em><span class="c012">#&gt;</span></em></span><em><span class="c012">
</span></em><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012">:</span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012"><span class="c014">prefix</span></span></em><em><span class="c012"> </span></em><em><span class="c012"><span class="c014">schema:</span></span></em><em><span class="c012"> &lt;</span></em><em><span class="c012">http:</span></em><em><span class="c012">//</span></em><em><span class="c012">schema</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/&gt;</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">&lt;&gt; </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">sx:Schema</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012">sx:shapes</span></em><em><span class="c012"> </span></em><em><span class="c012">:User</span></em><em><span class="c012"> .</span></em><em><span class="c012">
</span></em><em><span class="c012">
</span></em><em><span class="c012">:User</span></em><em><span class="c012"> </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">sx:ShapeAnd</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">   </span></em><em><span class="c012">sx:shapeExprs</span></em><em><span class="c012"> (</span></em><em><span class="c012">
</span></em><em><span class="c012">   [ </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">sx:NodeConstraint</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">       </span></em><em><span class="c012">sx:nodeKind</span></em><em><span class="c012"> </span></em><em><span class="c012">sx:iri</span></em><em><span class="c012"> ]</span></em><em><span class="c012">
</span></em><em><span class="c012">   [ </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">sx:Shape</span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">     </span></em><em><span class="c012">sx:expression</span></em><em><span class="c012"> [</span></em><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">sx:EachOf</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">      </span></em><em><span class="c012">sx:expressions</span></em><em><span class="c012"> (</span></em><em><span class="c012">
</span></em><em><span class="c012">      [ </span></em><em><span class="c012">a</span></em><em><span class="c012">            </span></em><em><span class="c012">sx:TripleConstraint</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">sx:predicate</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:name</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">sx:valueExpr</span></em><em><span class="c012"> [</span></em><em><span class="c012">
</span></em><em><span class="c012">         </span></em><em><span class="c012">a</span></em><em><span class="c012"> </span></em><em><span class="c012">sx:NodeConstraint</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">         </span></em><em><span class="c012">sx:datatype</span></em><em><span class="c012"> </span></em><em><span class="c012">xsd:string</span></em><em><span class="c012">
</span></em><em><span class="c012">        ]</span></em><em><span class="c012">
</span></em><em><span class="c012">      ]</span></em><em><span class="c012">
</span></em><em><span class="c012">      [ </span></em><em><span class="c012">a</span></em><em><span class="c012">            </span></em><em><span class="c012">sx:TripleConstraint</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">sx:predicate</span></em><em><span class="c012"> </span></em><em><span class="c012">schema:knows</span></em><em><span class="c012"> ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">sx:valueExpr</span></em><em><span class="c012"> </span></em><em><span class="c012">:User</span></em><em><span class="c012">;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">sx:min</span></em><em><span class="c012">       0 ;</span></em><em><span class="c012">
</span></em><em><span class="c012">        </span></em><em><span class="c012">sx:max</span></em><em><span class="c012">       -1</span></em><em><span class="c012">
</span></em><em><span class="c012">      ] )</span></em><em><span class="c012">
</span></em><em><span class="c012"> ] ] ).</span></em></td></tr>
</table><p><em>It can can also be represented in JSON-LD as: </em></p><table class="lstframe c015"><tr><td class="lstlisting"><em><span class="c012">{ "</span></em><em><span class="c012">@context</span></em><em><span class="c012">": "</span></em><em><span class="c012">https</span></em><em><span class="c012">://</span></em><em><span class="c012">shexspec</span></em><em><span class="c012">.</span></em><em><span class="c012">github</span></em><em><span class="c012">.</span></em><em><span class="c012">io</span></em><em><span class="c012">/</span></em><em><span class="c012">context</span></em><em><span class="c012">.</span></em><em><span class="c012">jsonld</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">  "</span></em><em><span class="c012">type</span></em><em><span class="c012">": "</span></em><em><span class="c012">Schema</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">  "</span></em><em><span class="c012">shapes</span></em><em><span class="c012">": [</span></em><em><span class="c012">
</span></em><em><span class="c012">    { "</span></em><em><span class="c012">type</span></em><em><span class="c012">": "</span></em><em><span class="c012">ShapeAnd</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">      "</span></em><em><span class="c012">shapeExprs</span></em><em><span class="c012">": [</span></em><em><span class="c012">
</span></em><em><span class="c012">        { "</span></em><em><span class="c012">type</span></em><em><span class="c012">": "</span></em><em><span class="c012">NodeConstraint</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">          "</span></em><em><span class="c012">nodeKind</span></em><em><span class="c012">": "</span></em><em><span class="c012">iri</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">        },</span></em><em><span class="c012">
</span></em><em><span class="c012">        { "</span></em><em><span class="c012">type</span></em><em><span class="c012">": "</span></em><em><span class="c012">Shape</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">          "</span></em><em><span class="c012">expression</span></em><em><span class="c012">": {</span></em><em><span class="c012">
</span></em><em><span class="c012">            "</span></em><em><span class="c012">type</span></em><em><span class="c012">": "</span></em><em><span class="c012">EachOf</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">            "</span></em><em><span class="c012">expressions</span></em><em><span class="c012">": [</span></em><em><span class="c012">
</span></em><em><span class="c012">              { "</span></em><em><span class="c012">type</span></em><em><span class="c012">":      "</span></em><em><span class="c012">TripleConstraint</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">                "</span></em><em><span class="c012">predicate</span></em><em><span class="c012">": "</span></em><em><span class="c012">http</span></em><em><span class="c012">://</span></em><em><span class="c012">schema</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/</span></em><em><span class="c012">name</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">                "</span></em><em><span class="c012">valueExpr</span></em><em><span class="c012">": { "</span></em><em><span class="c012">type</span></em><em><span class="c012">": "</span></em><em><span class="c012">NodeConstraint</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">                  "</span></em><em><span class="c012">datatype</span></em><em><span class="c012">": "</span></em><em><span class="c012">xsd</span></em><em><span class="c012">:</span></em><em><span class="c012">string</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">                }</span></em><em><span class="c012">
</span></em><em><span class="c012">              },</span></em><em><span class="c012">
</span></em><em><span class="c012">              { "</span></em><em><span class="c012">type</span></em><em><span class="c012">":      "</span></em><em><span class="c012">TripleConstraint</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">                "</span></em><em><span class="c012">predicate</span></em><em><span class="c012">": "</span></em><em><span class="c012">http</span></em><em><span class="c012">://</span></em><em><span class="c012">schema</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/</span></em><em><span class="c012">knows</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">                "</span></em><em><span class="c012">valueExpr</span></em><em><span class="c012">": "</span></em><em><span class="c012">http</span></em><em><span class="c012">://</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/</span></em><em><span class="c012">User</span></em><em><span class="c012">",</span></em><em><span class="c012">
</span></em><em><span class="c012">                "</span></em><em><span class="c012">min</span></em><em><span class="c012">":       0,</span></em><em><span class="c012">
</span></em><em><span class="c012">                "</span></em><em><span class="c012">max</span></em><em><span class="c012">":       -1</span></em><em><span class="c012">
</span></em><em><span class="c012">              }</span></em><em><span class="c012">
</span></em><em><span class="c012">            ]</span></em><em><span class="c012">
</span></em><em><span class="c012">          }</span></em><em><span class="c012">
</span></em><em><span class="c012">        }</span></em><em><span class="c012">
</span></em><em><span class="c012">      ],</span></em><em><span class="c012">
</span></em><em><span class="c012">      "</span></em><em><span class="c012">id</span></em><em><span class="c012">": "</span></em><em><span class="c012">http</span></em><em><span class="c012">://</span></em><em><span class="c012">example</span></em><em><span class="c012">.</span></em><em><span class="c012">org</span></em><em><span class="c012">/</span></em><em><span class="c012">User</span></em><em><span class="c012">"</span></em><em><span class="c012">
</span></em><em><span class="c012">    }</span></em><em><span class="c012">
</span></em><em><span class="c012">  ]</span></em><em><span class="c012">
</span></em><em><span class="c012">}</span></em></td></tr>
</table></div></div>
<h2 class="section" id="sec120">4.14  Summary</h2>
<p>
<a id="ch4.sec12"></a></p><p>In this chapter we learned about the ShEx language. </p><ul class="itemize"><li class="li-itemize">ShEx was designed as a human-readable language for RDF description and validation. </li><li class="li-itemize">ShEx can be considered as a grammar for RDF.</li><li class="li-itemize">There are two syntaxes for ShEx: A compact syntax and an RDF-based.</li><li class="li-itemize">ShEx defines the notion of shape expressions and node constraints.</li><li class="li-itemize">Shape Expressions can be combined using the logical operators: AND, OR, and NOT on top of triple expressions.</li><li class="li-itemize">Triple expressions declare the topology of the neighborhood of a node (incoming and outgoing edges).</li><li class="li-itemize">Node constraints declare constraints on the form of a single node.</li><li class="li-itemize">Semantic actions offer an extension mechanism over ShEx.</li></ul>
<h2 class="section" id="sec121">4.15  Suggested Reading</h2>
<p>
<a id="ch4.sec13"></a></p><p>We collected the following selection of references about Shape Expressions. </p><ul class="itemize"><li class="li-itemize">Short introduction to ShEx: <a href="bookHtml018.html#ShExPrimer">Baker and Prud’hommeaux</a>,<a href="bookHtml018.html#ShExPrimer">2017</a> [<a href="bookHtml018.html#ShExPrimer">7</a>] 
</li><li class="li-itemize">ShEx 2.0 language specification: <a href="bookHtml018.html#ShExSpec">Prud’hommeaux, Boneva, Labra Gayo, and
Kellog</a>,<a href="bookHtml018.html#ShExSpec">2017</a> [<a href="bookHtml018.html#ShExSpec">81</a>]
</li><li class="li-itemize">Description of the first version of ShEx: <a href="bookHtml018.html#EricSemantics2014">Prud’hommeaux, Labra Gayo, and
Solbrig</a>,<a href="bookHtml018.html#EricSemantics2014">2014</a> [<a href="bookHtml018.html#EricSemantics2014">80</a>] 
</li><li class="li-itemize">An algorithm to implement Shape Expressions based on derivatives: <a href="bookHtml018.html#LabraShexDerivatives15">Gayo, Prud’hommeaux, Boneva, Staworko, Solbrig, and
Hym</a>,<a href="bookHtml018.html#LabraShexDerivatives15">2016</a> [<a href="bookHtml018.html#LabraShexDerivatives15">40</a>] 
</li><li class="li-itemize">Theoretical foundations of ShEx: <a href="bookHtml018.html#Slawek2015">Staworko, Boneva, Labra Gayo, Hym, Prud’hommeaux,
and Solbrig</a>,<a href="bookHtml018.html#Slawek2015">2015</a> [<a href="bookHtml018.html#Slawek2015">94</a>]
<a href="http://labra.github.io/pdf/2015_ComplexityExpressivenessShEx.pdf"><span class="c011">http://labra.github.io/pdf/2015_ComplexityExpressivenessShEx.pdf</span></a>
</li><li class="li-itemize">Well-founded semantics of shape schemas (which are the basis of ShEx): <a href="bookHtml018.html#Boneva17">Boneva, Labra Gayo, and Prud’hommeaux</a>,<a href="bookHtml018.html#Boneva17">2017</a> [<a href="bookHtml018.html#Boneva17">11</a>]
<a href="https://labra.github.io/pdf/2017_SemanticsValidationShapesSchemas.pdf"><span class="c011">https://labra.github.io/pdf/2017_SemanticsValidationShapesSchemas.pdf</span></a></li></ul>
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note8" href="#text8">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">We will see that the pipe operator can also be used to form triple expressions in Section <a href="#ch040oneOf">4.6.4</a>.</div></dd><dt class="dt-thefootnotes"><a id="note9" href="#text9">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">At the time of this writing shape maps specification requires full IRIs but we use prefixed IRIs for simplicity.</div></dd><dt class="dt-thefootnotes"><a id="note10" href="#text10">3</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">The name semantic actions is inspired by parser generators.
It is not related to the semantic web.</div></dd><dt class="dt-thefootnotes"><a id="note11" href="#text11">4</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">See: http://shex.io/extensions/Map/</div></dd><dt class="dt-thefootnotes"><a id="note12" href="#text12">5</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">See: http://shexspec.github.io/extensions/Test/</div></dd><dt class="dt-thefootnotes"><a id="note13" href="#text13">6</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Note that a value of 
<code>-1</code> in 
<code>max</code> means unbounded.</div></dd></dl>
<hr>
<a href="bookHtml009.html"><img src="previous_motif.gif" alt="Previous"></a>
<a href="index.html"><img src="contents_motif.gif" alt="Up"></a>
<a href="bookHtml011.html"><img src="next_motif.gif" alt="Next"></a>
</body>
</html>
